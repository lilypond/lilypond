\input texinfo @c -*- coding: utf-8; mode: texinfo; documentlanguage: fr -*-

@ignore
    Translation of GIT committish: bf25a579ef63d3e07f782e7fa7d9178fefa705ce

    When revising a translation, copy the HEAD committish of the
    version that you are working on.  For details, see the Contributors'
    Guide, node Updating translation committishes..
@end ignore

@c Translators: Jean-Charles Malahieude
@c Translation checkers: Jean Abou Samra

@setfilename lilypond-changes.info
@settitle LilyPond Changes

@c no dircategory nor direntry in  French
@c since info is not translated. -JCM
@c deux lignes vides entre les items

@include fr/macros.itexi

@documentencoding UTF-8
@documentlanguage fr
@afourpaper

@macro manualIntro
Ce document recense les modifications et les nouvelles fonctionnalit√©s
de LilyPond pour la version @version{} (depuis la 2.22).
@end macro

@lilyTitlePage{Nouveaut√©s}

@iftex
@allowcodebreaks false
@end iftex

@ignore

HINTS

* only show verbatim input for syntax/input changes

* try to be as brief possible in those cases

* don't try to provide real-world examples, they often get too big,
which scares away people.

* Write complete sentences.

* only show user-visible changes.

@end ignore


@warning{Chaque nouvelle version de LilyPond peut comporter des
changements de syntaxe, ce qui peut exiger de modifier les fichiers que
vous avez √©crits avec des vesrions pr√©c√©dentes, de telle sorte qu'ils
restent fonctionnels avec les nouvelles versions. Afin de mettre √† jour
vos fichiers, il est @strong{fortement conseill√©} d'utiliser
l'utilitaire @command{convert-ly} distribu√© avec LilyPond et qui est
abord√© dans @rprogram{Mise √† jour avec convert-ly}. @command{convert-ly}
est capable de r√©aliser la plupart des modifications de syntaxe
automatiquement. Les utilisateurs de Frescobaldi peuvent lancer
@command{convert-ly} directement √† partir du menu de Frescobaldi en
faisant ¬´¬†Outils > Mettre √† jour avec convert-ly@dots{}¬†¬ª. D'autres
environnements prenant en charge LilyPond sont susceptibles de fournir
un moyen graphique de lancer @command{convert-ly}.}


@node Modifications majeures de LilyPond
@unnumbered Modifications majeures de LilyPond
@translationof Major changes in LilyPond

@itemize

@item
LilyPond requiert d√©sormais Guile 2.2. M√™me si vous n'√™tes pas
personnellement l'auteur de code Scheme, vous pourriez avoir recours √†
des biblioth√®ques de personnalisation √©volu√©e. Si elles venaient √† ne
pas fonctionner avec la version @version{} de LilyPond, veuillez vous
adresser aux d√©veloppeurs de ces biblioth√®ques.  Si vous √™tes vous-m√™me
d√©veloppeur de biblioth√®ques Scheme, veuillez lire @ref{Notes sur Guile 2.2}
ci-dessous.

@item
L'infrastructure permettant de g√©n√©rer les binaires officiels a √©t√©
compl√®tement r√©√©crite, de concert avec la bascule sur Guile¬†2.2. Nous
fournissons, √† compter de cette version, des binaires 64 bits pour macOS
et Windows. Par ailleurs, tous les paquetages sont disponibles sous
forme de simples archives qui peuvent √™tre d√©pli√©es dans n'importe quel
endroit pour ¬´¬†installation¬†¬ª. Il suffira, pour d√©sinstaller, de
simplement supprimer le dossier en question. Est aussi abandonn√©
l'√©diteur de base, LilyPad, qui √©tait install√© sur macOS et Windows.
Nous recommandons l'utilisation de solutions externes telles que
l'√©diteur bien connu @uref{https://frescobaldi.org,Frescobaldi} ou l'un
de ceux mentionn√©s dans @rweb{Facilit√©s d'√©dition}. Pour de plus amples
informations, veuillez consulter les instructions d√©taill√©es dans
@rlearning{Installation}.

Dans les paquetages officiels, Ghostscript ne contient plus son
propre jeu de polices par d√©faut, ceci afin de r√©duire la taille
des archives √† t√©l√©charger.  LilyPond n'a pas besoin de ces
polices (l'application contient elle-m√™me les polices dont elle a
besoin).  Cependant, quelques utilisateurs y faisaient appel avec
des instructions comme @code{/Arial findfont} dans du code
PostScript ins√©r√© avec @code{\markup \postscript}.  Il est
recommand√© d'utiliser la syntaxe @code{\markup} normale pour le
texte plut√¥t que du code PostScript √©crit √† la main.


@end itemize


@node Probl√®mes connus de LilyPond @version{}
@unnumberedsec Probl√®mes connus de LilyPond @version{}
@translationof Known issues in LilyPond @version{}

Sur Windows, la compilation de partitions volumineuses (quelques
centaines de pages) peut entra√Æner un crash.@footnote{Il est √† noter que
d'imposantes partitions pouvaient d√©j√† crasher avec LilyPond 2.22 en
raison de restrictions inh√©rentes √† l'architecture 32¬†bits.} Nous
esp√©rons r√©soudre ce probl√®me dans une future version¬†2.24.@var{x}.


@node Notes √† propos de la compilation des sources et √† l'attention des empaqueteurs
@unnumberedsec Notes √† propos de la compilation des sources et √† l'attention des empaqueteurs
@translationof Notes for source compilation and packagers

La pr√©sente section s'adresse aux entousiastes d√©sirant compiler
LilyPond √† partir des sources et aux empacteurs qui pr√©parent LilyPond
pour les diff√©rentes distributions. Si vous ne faites partie d'aucun de
ces groupes, vous pouvez passer cette section.

@itemize

@item
Comme annonc√© plus haut, LilyPond requiert d√©sormais Guile 2.2. Selon
les exigences de la distribution, on peut aussi compiler avec Guile 3.0
en passant @command{GUILE_FLAVOR=guile-3.0} au script
@command{configure}. Ceci n'est toutefois pas recommand√© et n'est pas
officiellement pris en charge.

@item
L'√©valuateur de code Scheme est plus lent avec Guile 2.2 qu'il ne
l'√©tait avec Guile 1.@var{x}. Pour att√©nuer cette baisse de performance,
nous recommandons de compiler les fichiers @file{.scm} en bytecode
ajoutant @command{make bytecode} √† la compilation, puis @command{make
install-bytecode} en plus de @command{make install}.

@item
√Ä compte de cette version stable, le syst√®me de construction de LilyPond
n'installe plus de fonte textuelle. Nous vous remercions d'en fournir en
tant que paquetages ind√©pendants, tout en v√©rifiant leur licence et les
fichiers de notice.


@end itemize


@node Nouveaut√©s en mati√®re de notation musicale
@unnumbered Nouveaut√©s en mati√®re de notation musicale
@translationof New for musical notation


@node Am√©liorations de la repr√©sentation des hauteurs
@unnumberedsec Am√©liorations de la repr√©sentation des hauteurs
@translationof Pitches improvements

@itemize
@item
La prise en charge d'alt√©rations alternatives s'am√©liore. Gr√¢ce √† la
propri√©t√© @code{alterationGlyphs} des contextes de niveau port√©e,
peuvent se d√©finir globalement les glyphes √† utiliser pour tous les
objets -- voir @ruser{Glyphes d'alt√©ration alternatifs}.

@lilypond[quote]
\layout {
  \context {
    \Staff
    alterationGlyphs =
      #'((-1/2 . "accidentals.flat.arrowdown")
         (0 . "accidentals.natural.arrowup")
         (1/2 . "accidentals.sharp.arrowup"))
  }
}

\new Voice \with {
  \consists Ambitus_engraver
}
{
  \key g \major
  ces''
  \set suggestAccidentals = ##t
  c''
  \unset suggestAccidentals
  \accidentalStyle teaching
  fis''
}
@end lilypond


@item
Les crochets d'octaviation peuvent s'appliquer √† une seule voix plut√¥t
qu'√† l'int√©gralit√© de la port√©e. Ceci demandait auparavant quelques
circonvolutions.

@example
\layout @{
  \context @{
    \Staff
    \remove Ottava_spanner_engraver
  @}
  \context @{
    \Voice
    \consists Ottava_spanner_engraver
  @}
@}
@end example

@lilypond[quote]
\layout {
  \context {
    \Staff
    \remove Ottava_spanner_engraver
  }
  \context {
    \Voice
    \consists Ottava_spanner_engraver
  }
}

{
  \clef bass
  << { <g d'>1~ q2 <c' e'> }
  \\
    {
      r2.
      \ottava -1
      <b,,, b,,>4 ~ |
      q2
      \ottava 0
      <c e>2
    }
  >>
}
@end lilypond

@end itemize


@node Am√©liorations en mati√®re de rythme
@unnumberedsec Am√©liorations en mati√®re de rythme
@translationof Rhythm improvements

@itemize
@item
La nouvelle commande @code{\section} ins√®re une double barre qui
interagit de mani√®re optimale avec les barres de reprise. Un passage
peut √™tre nomm√© √† l'aide de la commande @code{\sectionLabel}.

@lilypond[verbatim,quote,line-width=9\cm]
\fixed c' {
  f1
  \break
  \section
  \sectionLabel "Trio"
  \repeat volta 2 {
    b1
  }
}
@end lilypond


@item
@code{\numericTimeSignature} et @code{\defaultTimeSignature}
s'appliquent d√©sormais en m√™me temps √† toutes les port√©es -- plus
pr√©cis√©ment √† toutes les port√©es d'un m√™me contexte @code{Timing} --
afin de correspondre au comportement de @code{\time}.


@item
La commande de @emph{markup} @code{\rhythm} fait son apparition. Il
s'agit d'un moyen simple de m√©langer du texte et du rythme comme, par
exemple, pour afficher une indication de ¬´¬†swing¬†¬ª.

@lilypond[verbatim,quote]
\relative {
  \tempo \markup {
    Swing
    \hspace #0.4
    \rhythm { 8[ 8] } = \rhythm { \tuplet 3/2 { 4 8 } }
  }
  b8 g' c, d ees d16 ees d c r8
}
@end lilypond


@item
La commande @code{\enablePolymeter} agit comme un raccourci lors de la
saisie pour d√©placer les graveurs selon le besoin et permettre d'avoir
diff√©rentes m√©triques en parall√®le. Le code¬†:

@quotation
@verbatim
\layout {
  \context {
    \Score
    \remove Timing_translator
    \remove Default_bar_line_engraver
  }
  \context {
    \Staff
    \consists Timing_translator
    \consists Default_bar_line_engraver
  }
}
@end verbatim
@end quotation

@noindent
peut ainsi s'abr√©ger en¬†:

@quotation
@verbatim
\layout {
  \enablePolymeter
}
@end verbatim
@end quotation

Par ailleurs, le @code{Default_@/bar_@/line_@/engraver} a √©t√© supprim√©.


@item
La nouvelle option @code{visible-over-note-heads} permet aux crochets de
n-olets de toujours s'afficher lorsqu'ils sont plac√©s du c√¥t√© des t√™tes
de note. Cette option peut s'utiliser avec le style par d√©faut de
visibilit√© des crochets de n-olet ou avec @code{#'if-no-beam}.

@lilypond[quote]
music = \relative c'' {
  \tupletNeutral \tuplet 3/2 { c16[ d e } f8]
  \tupletUp \tuplet 3/2 { c8 d e }
}

\new Voice {
  \relative c' {
    \time 2/4
    \override TupletBracket.visible-over-note-heads = ##t
    \once \override Score.TextMark.break-align-symbols =
            #'(time-signature)
    { \textMark \markup "default" \music }
    \override TupletBracket.bracket-visibility = #'if-no-beam
    { \textMark \markup \typewriter "'if-no-beam" \music }
  }
}
@end lilypond


@item
Les compteurs de mesures prennent en consid√©ration les mesures √†
compter et les alternatives.

@lilypond[quote,line-width=15\cm]
\new Score \with {
  \consists Measure_counter_engraver
  \override MeasureCounter.font-encoding = #'latin1
  \override MeasureCounter.font-size = 1
  \override MeasureCounter.padding = 0.5
  \override MeasureCounter.font-series = #'bold
  alternativeNumberingStyle = #'numbers-with-letters
}
\new Voice \compressMMRests \relative {
  c'4-. 4-. 4-. 4-.
  r4 4-. 4-. r
  \startMeasureCount
  <<
    { R1 }
    \new CueVoice {
      \voiceTwo
      r4 c8( d) e-. g-.
    }
  >>
  R1*2
  \repeat volta 2 {
    c,8( d e g) c,( d e g)
  }
  \alternative {
    { c,8( d e g) c,( d e4) }
    { c8\< d e g c2\! R1*2 \bar "|." }
  }
  \stopMeasureCount
}
@end lilypond


@item
Les num√©ros de mesure peuvent se pr√©senter au centre de la mesure comme
il est d'usage dans les musiques de film.

@lilypond[verbatim,quote]
\layout {
  \context {
    \Score
    centerBarNumbers = ##t
    barNumberVisibility = #all-bar-numbers-visible
  }
}

<<
  { \repeat unfold 3 { c'4 d' e' f' } }
  { \repeat unfold 3 { c'4 d' e' f' } }
>>
@end lilypond


@item
L'alignement des num√©ros de mesure pr√©sents en cours ou en fin de ligne
s'effectue d√©sormais sur leur extr√©mit√© gauche. Il s'agit l√† de suivre
la recommandation d'Elaine Gould (@cite{Behind Bars}, p.¬†237) et le
consensus entre les d√©veloppeurs lors de la discussion de ce probl√®me.
Aucun changement n'intervient aux num√©ros port√©s en d√©but de ligne.


@item
L'instruction @code{\bar ","} cr√©e une barre de mesure raccourcie.

@lilypond[quote]
\new Staff \with {
  \omit Clef
  \omit TimeSignature
} \fixed c' {
  \cadenzaOn
  e2 f g a g \bar "," f g f d e\breve
}
@end lilypond


@item
Les types de barre pr√©d√©finie qui suivent n'apparaissent plus sous
forme de simple barre lorsqu'ils surviennent en fin de ligne. Des types
de barre annot√©e, tel que @code{\bar "S-|"}, ont √©t√© ajout√©s en
cons√©quence.

@lilypond[quote]
{
  R1 \bar ".|"
  R1 \bar ".|:"
  R1 \bar "[|:"
  R1 \bar "S"
  R1 \bar "S.|:"
  r4
}
@end lilypond


@item
L'instruction @code{\bar ""} n'est plus un pr√©alable √† l'affichage du
num√©ro de la premi√®re mesure. Il suffit d√©sormais de r√©gler la propri√©t√©
@code{barNumberVisibility} √† @code{all-@/bar-@/numbers-@/visible} ou
l'un des autres r√©glages pour lesquels le premier num√©ro de mesure est
visible.

Notez bien qu'il s'agit d'un changement de comportement pour les
partitions dans lesquelles @code{barNumberVisibility} est r√©gl√© √†
@code{all-@/bar-@/numbers-@/visible} ou √©quivalent et
@code{BarNumber@/.break-@/visibility} activ√© sans avoir de
@code{\bar¬†""}. Un num√©ro de mesure est d√©sormais affich√© au d√©but. Il
s'agit bien du comportement attendu (@strong{tous} les num√©ros devraient
√™tre visibles) mais, en raison d'une documentation probablement pas
assez explicite, certains utilisateurs ont opt√© pour ces r√©glages afin
d'afficher les num√©ros de mesure en cours de port√©e sauf pour la
premi√®re mesure. En pareil cas, il convient de tout simplement supprimer
la clause
@code{\set Score@/.barNumberVisibility = #all-@/bar-@/numbers-@/visible}
puisque @code{\override BarNumber@/.break-@/visibility = ##t} est le
r√©glage appropri√© et suffisant.


@item
D√©sormais, la commande @code{\break} ins√®re toujours un saut,
outrepassant toutes les d√©cisions par d√©faut quant aux points de
rupture. Par exemple, il n'est d√©sormais plus n√©cessaire d'ajouter
@code{\bar¬†""} pour obtenir une rupture en cours de mesure.

La nouvelle commande @code{\allowBreak} ins√®re un point de rupture
potentiel, sans le forcer, mais outrepasse les d√©cisions par d√©faut √†
l'instar de @code{\break}.


@item
Le type de barre de mesure @code{"-"} a √©t√© supprim√©. @command{convert-ly}
le convertit en¬†@code{""}. Il en r√©sulte une l√©g√®re diff√©rence dans
l'espacement horizontal lors d'un saut de ligne.


@item
@code{automaticBars} a √©t√© supprim√©. @command{convert-ly} convertit
@code{automaticBars = ##f} en @code{measureBarType = #'()}.


@item
Au lieu de r√©p√©ter le nom de glyphe en cours de ligne,
@code{\defineBarLine} accepte d√©sormais la valeur¬†@code{#t}.


@item
Le @code{Bar_engraver} interdisait jusqu'√† pr√©sent un saut de ligne
entre deux barres de mesure¬†; il ne le fait dor√©navant que lorsque la
propri√©t√© de contexte @code{forbidBreakBetweenBarLines} est activ√©e
(r√©gl√©e √†¬†@code{#t}), ce qui est le cas par d√©faut.


@item
En raison de modifications dans le fonctionnement interne de
l'instruction @code{\bar}, il n'est d√©sormais plus possible de
l'instancier avant la cr√©ation de contextes inf√©rieurs par un
@code{\new} sous peine de cr√©er une port√©e intempestive comme lors de
l'utilisation de commandes telles que @code{\override Staff@dots{}}
(voir @rprogram{Apparition d'une port√©e suppl√©mentaire}).

@lilypond[verbatim,quote]
{
  \bar ".|:"
  <<
    \new Staff { c' }
    \new Staff { c' }
  >>
}
@end lilypond

La solution consiste √† placer le @code{\bar} au sein m√™me de la musique
dans chaque port√©e, comme c'est g√©n√©ralement le cas pour la plupart des
commandes.

@lilypond[verbatim,quote]
<<
  \new Staff { \bar ".|:" c' }
  \new Staff { \bar ".|:" c' }
>>
@end lilypond


@item
Le type de barre @code{"-span|"} cr√©e un @notation{mensurstrich} --
impression des lignes de mensuration.

@lilypond[quote]
\new StaffGroup \with { measureBarType = "-span|" } <<
  \new Staff \fixed c'' { c4 d e f e d }
  \new Staff \fixed c' { a2 f2. g4 }
>>
@end lilypond


@item
Les contextes @code{Staff} utilisent d√©sormais le nouveau
@code{Caesura_engraver} pour r√©aliser la commande @code{\caesura}.

@lilypond[quote]
\fixed c' {
  c2 \caesura d2
  e1 \caesura \once \set Staff.caesuraType = #'((scripts . (fermata)))
  f1
}
@end lilypond


@end itemize


@node Am√©liorations en mati√®re d'expressivit√©
@unnumberedsec Am√©liorations en mati√®re d'expressivit√©
@translationof Expressive mark improvements

@itemize
@item
Les √©v√©nements attach√©s √† des notes, tels que nuances ou articulations,
peuvent √™tre diff√©r√©s d'une dur√©e arbitraire √† l'aide de @code{\after}.
Ceci permet de simplifier de nombreuses situations qui jusqu'alors
demandaient de recourir √† une polyphonie et des silences invisibles.

@lilypond[verbatim,quote]
{
  \after 2 \turn g'2. a'4
  \after 2 \< b'1
  \after 2. \f c''
  <>\< \after 4 \> \after 2\! d''
}
@end lilypond


@item
La deuxi√®me portion des soufflets tronqu√©s b√©n√©ficie maintenant d'un
rembourrage √† gauche. Ceci est conforme aux canons de la gravure et
r√®gle le probl√®me de d√©callage vertical qui pouvait intervenir en raison
de l'armure.

@lilypond[verbatim,quote]
\relative {
  \key a \major
  c''4^\< c c c \break c c c c\! |
}
@end lilypond


@item
Les terminaisons des soufflets peuvent d√©sormais s'aligner sur la
gauche, au centre ou sur la droite des @emph{grobs} @code{NoteColumn} √†
l'aide d'une d√©rogation √† la propri√©t√© @code{endpoint-alignments}.

@lilypond[quote]
{
  c'2\< <c' d'>\! |
  \override Hairpin.endpoint-alignments = #`(,RIGHT . ,LEFT)
  c'2\< <c' d'>\! |
  \override Hairpin.endpoint-alignments = #`(,CENTER . ,CENTER)
  c'2\< <c' d'>\! |
}
@end lilypond


@item
Le positionnement des extensions de trille peut d√©sormais se sp√©cifier
comme pour toute indication d'articulation, autrement dit √† l'aide de
@code{_\startTrillSpan} ou @code{^\startTrillSpan}.


@item
L'apparence des extensions de trille a √©t√© modifi√©e pour mieux
correspondre aux conventions classiques de la gravure. L'extension
s'arr√™te d√©sormais juste avant la note qui suit, sans la chevaucher. Ce
sera juste avant l'alt√©ration si la note qui suit en est pourvue, et au
niveau de la barre si la prochaine note est dans la mesure suivante.

@lilypond[quote]
{
  \override Score.SpacingSpanner.spacing-increment = 2.1
  d''2\startTrillSpan 2\stopTrillSpan
  2\startTrillSpan deses''2\stopTrillSpan
  d''1\startTrillSpan 1\stopTrillSpan
}
@end lilypond


@item
Le d√©calage par d√©faut des points d'orgue a √©t√© √©largi. Ceci permet de
pallier certains cas o√π, en pr√©sence d‚Äôune note point√©e, ils √©taient
trop proches des points et des autres objets.

@lilypond[quote]
\relative c''' {
  \tempo 4 = 60
  a4.
  a4.\fermata
  a4.\henzeshortfermata
  a4.\henzelongfermata
  a4.\shortfermata
  a4.\longfermata
  a4.\veryshortfermata
  a4.\verylongfermata
}
@end lilypond


@item
Le symbole de flageolet est d√©sormais plus petit et un peu plus √©pais.
Ceci correspond plus aux partitions que l'on peut trouver et rend
inutile la retouche @code{\tweak font-size -3 \flageolet} jusqu'ici
recommand√©e.

@lilypond[quote]
{
  d''2^\flageolet d''_\flageolet
}
@end lilypond


@item
Le glyphe d'accent est un peu plus petit qu'auparavant. Ceci permet de
pallier certains cas o√π, par exemple, la pr√©sence d'un b√©carre aurait
d√©plac√© l'accent verticalement.

@lilypond[quote]
{
  f'!8[-> f'-> f'-> f'->]
}
@end lilypond


@item
Le glyphe de virgule stylis√©, tel que celui utilis√© par la commande
@code{\breathe}, adopte une forme plus habituelle.

@lilypond[quote]
{ f'2 \breathe f'2 }
@end lilypond

L'ancienne forme reste accessible sous le nom de ¬´¬†raltcomma¬†¬ª¬†:

@lilypond[quote,verbatim]
{
  \override BreathingSign.text =
    \markup { \musicglyph "scripts.raltcomma" }
  f'2 \breathe f' |
}
@end lilypond


@item
La nouvelle propri√©t√© de contexte @code{breathMarkType} s√©lectionne le
marqueur produit par la commande @code{\breathe} parmi plusieurs types
pr√©d√©finis.

@lilypond[verbatim,quote]
\fixed c' {
  \set breathMarkType = #'tickmark
  c2 \breathe d2
}
@end lilypond

@end itemize


@node Am√©liorations en mati√®re de reprises
@unnumberedsec Am√©liorations en mati√®re de reprises
@translationof Repeat improvements

@itemize
@item
Les alternatives peuvent se placer au sein m√™me du bloc de r√©p√©tition.

@lilypond[verbatim,quote]
\repeat volta 3 { c'1 \alternative { d' e' } f' }
@end lilypond


@item
Les num√©ros d'alternative peuvent se d√©finir √† l'aide de la commande
@code{\volta}.

@lilypond[verbatim,quote]
\repeat volta 3 c'1 \alternative { \volta 1 d' \volta 2,3 e' }
@end lilypond


@item
La nouvelle commande @code{\repeat segno} permet de g√©rer
automatiquement un certain nombre de formes @emph{da-capo} et
@emph{dal-segno}.

@lilypond[verbatim,quote]
music = \fixed c' {
  \repeat segno 2 {
    b1
  }
  \fine
}

\score { \music }
\score { \unfoldRepeats \music }
@end lilypond


@item
La nouvelle commande @code{\fine} ins√®re une barre de mesure finale qui
interagit de fa√ßon optimale avec les barres de reprise. Plac√©e √†
l'int√©rieur d'une reprise, elle ajoute une instruction @emph{Fine} et
termine la musique lorsque les reprises sont expans√©es.

@lilypond[verbatim,quote]
music = \fixed c' {
  \repeat volta 2 {
    f1
    \volta 2 \fine
    \volta 1 b1
  }
}

\score { \music }
\score { \unfoldRepeats \music }
@end lilypond

@item
La commande @code{\volta} suprime la musique lorsque la r√©p√©tition est
expans√©e.


@item
La commande @code{\unfolded} ajoute la musique lorsque la r√©p√©tition est
expans√©e.


@end itemize


@node Am√©liorations en mati√®re d'annotations √©ditoriales
@unnumberedsec Am√©liorations en mati√®re d'annotations √©ditoriales
@translationof Editorial annotation improvements

@itemize
@item
Les nouvelles commandes @code{\staffHighlight} et
@code{\stopStaffHighlight} permettent de coloriser des fragments
musicaux.

@lilypond
\relative {
  \staffHighlight lightsteelblue
  c'4 e g c
  \staffHighlight lightpink
  d, f a d
  \staffHighlight lightsteelblue
  c, e g c
}
@end lilypond


@item
Le nouvel objet graphique @code{FingerGlideSpanner} permet d'indiquer le
gliss√© d'un doigt sur une corde passant d'une position √† une autre. Il
peut se pr√©senter sous diff√©rentes formes selon le style adopt√©¬†; l'image
ci-dessous affiche les styles @code{line}, @code{stub-left},
@code{stub-right} et @code{stub-both}.

@lilypond[quote]
mus = {
  \set fingeringOrientations = #'(right)
  <a'\glide-1>2.
  \set fingeringOrientations = #'(left)
  <d'-1>4
}

\score {
  {
    <>^"line"
    \mus
    <>^"stub-left"
    \override FingerGlideSpanner.style = #'stub-left
    \mus
    <>^"stub-right"
    \override FingerGlideSpanner.style = #'stub-right
    \mus
    <>^"stub-both"
    \override FingerGlideSpanner.style = #'stub-both
    \mus
  }
}
@end lilypond
@noindent
D'autres styles sont disponibles¬†: @code{dashed-line},
@code{dotted-line}, @code{zigzag}, @code{trill}, @code{bow} et
@code{none}.


@item
La mise en forme des info-bulles est d√©sormais modifiable.

@lilypond[quote]
\new Score \with {
  \consists Balloon_engraver
  \override SpacingSpanner.spacing-increment = 5
}
{
  \balloonLengthOn
  \balloonGrobText Rest #'(1 . 2) "rest"
  r4
  \once \override Score.BalloonText.Y-attachment = #CENTER
  \once \override Score.BalloonText.text-alignment-X = #CENTER
  \balloonGrobText Rest #'(1 . 3.5) "rest"
  r4
}
@end lilypond


@item
Il est d√©sormais possible de placer un accord entre parenth√®ses.
Toutefois, la taille de la fonte utilis√©e pour les parenth√®ses devra
√™tre ajust√©e manuellement.

@lilypond[quote]
\new Voice {
  \tweak Parentheses.font-size -2 \parenthesize <a'' b''>2
  <<
    { \tweak Parentheses.font-size 0 \parenthesize <ces des> }
    { \parenthesize ees' }
    { \tweak Parentheses.font-size -2 \parenthesize <c'' e''> }
  >>
}
@end lilypond


@item
Les objets √©tendus ou bandeaux peuvent √™tre mis entre parenth√®ses.

@lilypond[quote]
{
  c'\parenthesize\< d'2.\!
  \parenthesize R1
}
@end lilypond


@item
Une version ¬´¬†temporelle¬†¬ª de la commande @code{\parenthesize} est
disponible. Elle prend en consid√©ration le chemin vers un objet
graphique¬†: @code{\parenthesize @var{NomGrob}} ou @code{\parenthesize
@var{ContextName}.@var{GrobName}}. Cette commande se comporte comme un
@code{\once \override}. Cette interface vient en compl√©ment de la forme
d√©j√† disponible @code{\parenthesize @var{√©v√©nement}}, de mani√®re
identique √† @code{\footnote}.

@lilypond[verbatim,quote]
{
  \parenthesize NoteHead
  c'1
  \parenthesize Staff.KeySignature
  \key g \major
  c'1
}
@end lilypond


@item
L'ajout du @code{Melody_engraver} √† un contexte @code{Voice} prend
d√©sormais en compte le sens de la m√©lodie pour orienter la hampe de la
note sur la ligne m√©diane. Il fallait auparavant apporter une d√©rogation
sp√©cifique √† la propri√©t√© @code{Stem.neutral-direction}.

@lilypond[verbatim,quote]
\new Voice \with {
  \consists Melody_engraver
}
\relative c'' {
  \autoBeamOff
  g8 b a e g b a g |
  c b d c b e d c |
}
@end lilypond

La propri√©t√© de contexte @code{suspendMelodyDecisions} permet de
d√©sactiver temporairement ce comportement, tout comme le faisait
@code{\override Stem.neutral-direction = #DOWN}.


@item
Le nouveau @code{Mark_tracking_translator} prend le pas sur le
@code{Mark_engraver} en mati√®re de d√©cision quant √† la cr√©ation d'une
marque. Le @code{Mark_engraver} se charge toutefois de contr√¥ler la mise
en forme et le positionnement vertical du rep√®re.

Par d√©faut, des @code{Mark_engravers} dans de multiples contextes
cr√©ent une s√©quence commune de rep√®res. Lorsque des s√©quences
ind√©pendantes sont pr√©f√©rables, il faut utiliser plusieurs
@code{Mark_tracking_translator}.


@end itemize


@node Am√©liorations en mati√®re de mise en forme du texte
@unnumberedsec Am√©liorations en mati√®re de mise en forme du texte
@translationof Text improvements

@itemize
@item
Les nouvelles commandes @code{\textMark} et @code{\textEndMark}
permettent d'ajouter entre les notes un texte arbitraire que l'on
appelle indication textuelle. Ces commandes constituent une am√©lioration
de la syntaxe utilis√©e pr√©c√©demment avec la commande @code{\mark} √†
laquelle on adjoignait un @emph{markup} -- autrement dit libeller
@code{\mark "@dots{}"} ou @code{\mark \markup @dots{}}.

@lilypond[verbatim,quote]
\fixed c' {
  \textMark "Text mark"
  c16 d e f e f e d c e d c e d c8
  \textEndMark "Text end mark"
}
@end lilypond

@code{\textMark} et @code{\textEndMark} sont d√©sormais les moyens
recommand√©s de cr√©er des indications textuelles. Le propos n'est pas ici
de d√©courager l'utilisation de @code{\mark}, mais de plut√¥t la r√©server
√† la cr√©ation des marques-rep√®res -- avec @code{\mark \default} ou
@code{\mark @var{nombre}} -- auxquelles il est souvent fait r√©f√©rence en
r√©p√©tition.

Ces nouvelle commandes diff√®rent de @code{\mark @var{markup}} par
quelques aspects. Alors que plusieurs indications peuvent survenir en un
m√™me endroit, il ne peut y avoir qu'une seule occurrence de @code{\mark}
(un seul rep√®re √† la fois). Elles g√©n√®rent des objets graphiques du type
@code{TextMark} particulier, alors que @code{\mark} g√©n√®re un objet
@code{RehearsalMark} que ce soit pour cr√©er un rep√®re ou une indication
textuelle. Cette distinction permet alors de g√©rer des r√©glages
diff√©rents pour les rep√®res et les indications textuelles. L'alignement
engendr√© par ces nouvelles commandes est diff√©rent¬†: l'indication cr√©√©e par
@code{\textMark} sera toujours align√©e par la gauche et celle cr√©√©e par
@code{\textEndMark} le sera toujours par la droite¬†; l'alignement d'un
@code{RehearsalMark}, par contre, d√©pend du point d'ancrage de l'objet
sur lequel il doit s'aligner.

Voir @ruser{Indications textuelles} pour de plus amples d√©tails.


@item
Sont d√©sormais disponibles dans la fonte Emmentaler, des variantes
textuelles pour les glyphes de di√®se, b√©mol, b√©carre, double di√®se et
double b√©mol. En mode @emph{markup}, ils sont accessibles par leur
valeur Unicode standard.

@lilypond[quote]
\markup \fontsize #6 \number "1 ‚ôØ 2 ‚ô≠ 3 ‚ôÆ 4 ùÑ´ 5 ùÑ™ 6"
@end lilypond


@item
Il est d√©sormais possible de contr√¥ler la largeur et l'aspect de
certains chiffres Emmentaler √† l'aide de fonctionnalit√©s OpenType.

@lilypond[quote]
\markuplist
  \number
  \fontsize #6
  \override #'((padding . 3)
               (baseline-skip . 7)
               (box-padding . 0)
               (thickness . 0.1))
  \table #'(-1 -1 -1 -1) {
      0123456789 \box 147 \concat { \box 1 \box 4 \box 7 }
    \normal-text \normalsize "(time signatures)"
    \override #'(font-features .("cv47")) {
      0123456789 \box 147 \concat { \box 1 \box 4 \box 7 } }
    \normal-text \normalsize "(alternatives)"
    \override #'(font-features .("tnum" "cv47" "-kern")) {
      0123456789 \box 147 \concat { \box 1 \box 4 \box 7 } }
    \normal-text \normalsize "(fixed-width)"
    \override #'(font-features . ("tnum" "cv47" "ss01")) {
      0123456789 \box 147 \concat { \box 1 \box 4 \box 7 } }
    \normal-text \normalsize "(figured bass)"
    \override #'(font-features . ("cv47" "ss01")) {
      0123456789 \box 147 \concat { \box 1 \box 4 \box 7 } }
    \normal-text \normalsize "(fingering)"
  }
@end lilypond


@item
@code{\smallCaps} est maintenant op√©rationnel sur tout @emph{markup},
non plus uniquement sur des cha√Ænes brutes.


@item
La syntaxe permettant de g√©rer des conditions pour les @emph{markups} a
gagn√© en flexibilit√© et en simplicit√©. Elle utilise les nouvelles
commandes de @emph{markup} @code{\if} et @code{\unless}. Voici quelques
uns des changements apport√©s¬†:

@multitable {@code{\on-the-fly #not-part-first-page @dots{}}} {@code{\unless \on-first-page-of-part @dots{}}}
@headitem Syntaxe version 2.22 @tab Syntaxe version 2.24
@item  @code{\on-the-fly #first-page @dots{}}
@tab @code{\if \on-first-page @dots{}}
@item  @code{\on-the-fly #not-part-first-page @dots{}}
@tab @code{\unless \on-first-page-of-part @dots{}}
@item  @code{\on-the-fly #(on-page @var{n}) @dots{}}
@tab @code{\if \on-page #@var{n} @dots{}}
@end multitable


@item
La nouvelle commande de @emph{markup} @code{string-lines} permet de
couper une cha√Æne √† un caract√®re donn√©. La coupure intervient par d√©faut
au saut de ligne, et les √©ventuels espaces sont ignor√©s. La liste
r√©sultante de @emph{markups} peut faire l'objet d'une mise en forme
particuli√®re. Cette fonctionnalit√© constitue un moyen tout √† fait adapt√©
pour ajouter des couplets √† une chanson.

@lilypond[quote]
\markup
  \column
  \string-lines
    "Twinkle, twinkle, little star,
     How I wonder what you are!
     Up above the world so high,
     Like a diamond in the sky.
     Twinkle, twinkle, little star,
     How I wonder what you are!"
@end lilypond


@item
La nouvelle commande de @emph{markup} @code{\align-on-other} d√©place un
@emph{markup} comme s'il √©tait align√© sur un autre.

@lilypond[quote]
\markup \column {
  1
  12
  \align-on-other #X #RIGHT 12
                     #LEFT 12345
  123
}
@end lilypond


@item
Sont maintenant disponibles les deux commandes de @emph{markup}
@code{\with-dimension} et @code{\with-dimension-from}. Elles sont
similaires √† @code{\with-dimensions} et @code{\with-dimensions-from}, √†
ceci pr√®s qu'elles permettent de ne jouer que sur une seule des deux
dimensions.


@item
Sont maintenant disponibles les commandes de @emph{markup}
@code{\with-true-dimension} et @code{\with-true-dimensions}. Elles
procurent l'√©tendue r√©elle de la surface encr√©e, qui peut √™tre quelque
peu diff√©rente de l'√©tendue par d√©faut pour certains glyphes en raison
des contraintes de r√©gularit√© du texte.

@lilypond[quote]
\markup
  \fontsize #10
  \override #'((box-padding . 0) (thickness . 0.02))
  \line
  \box {
    \musicglyph "scripts.trill"
    \with-true-dimensions \musicglyph "scripts.trill"
  }
@end lilypond


@item
Des textes de remplacement peuvent d√©sormais changer des cha√Ænes dans
tout @emph{markup}, au lieu de modifier une cha√Æne en particulier.

@lilypond[verbatim,quote]
\markup
  \replace #`(("2nd" . ,#{ \markup \concat { 2 \super nd } #}))
  "2nd time"
@end lilypond


@item
La commande de @emph{markup} @code{\with-string-transformer} est
d√©sormais disponible. Elle interpr√®te un @emph{markup} avec l'un des
¬´¬†transformateurs de cha√Æne¬†¬ª install√©s. Le transformateur est appel√©
lorsque l'interpr√©tation du @emph{markup} requiert l'interpr√©tation
d'une cha√Æne et permet d'op√©rer des modifications sur cette cha√Æne,
comme par exemple en basculer la casse.


@item
La fonction @code{markup->string} convertit un @emph{markup} dans une
r√©pr√©sentation approximative de cha√Æne de caract√®res. Ceci est utile
pour g√©n√©rer des m√©tadonn√©es PDF ainsi que les paroles et rep√®res en
MIDI. Il est donc possible de cr√©er des commandes pour @emph{markups}
personnalis√©es afin de retraiter les cha√Ænes converties par
@code{markup->string}, comme par exemple

@example
#(define-markup-command (upcase layout props arg) (string?)
   #:as-string (string-upcase arg)
   (interpret-markup layout props (string-upcase arg)))
@end example


@end itemize


@node Nouveaut√©s en mati√®re de notation sp√©cialis√©e
@unnumbered Nouveaut√©s en mati√®re de notation sp√©cialis√©e
@translationof New for specialist notation


@node Am√©liorations pour les cordes frett√©es
@unnumberedsec Am√©liorations pour les cordes frett√©es
@translationof Fretted string instrument improvements

@itemize
@item
Ajout des accordages pour banjo @code{banjo-double-c} et
@code{banjo-double-d}.


@item
Le nouvel objet graphique @code{BendSpanner} permet, dans le cadre d'un
@code{TabStaff}, d'indiquer une d√©sinance. En plus de l'apparence par
d√©faut sont disponibles les styles @code{'hold}, @code{'pre-bend} et
@code{'pre-bend-hold}.

@lilypond[quote]
mus = {
  d4\5\^ e\5\^ d2\5
  c'4\3\^ d'\3\bendHold \^ d'\3\^ c'\3
  \grace c'4\3\preBendHold \^ d'\3\bendHold \^ d'\3\^ c'2\3
  \grace c'4\3 \preBend \^ d'1\3
}

\score {
  \new StaffGroup
  <<
    \new Staff { \clef "G_8" \mus }
    \new TabVoice \mus
  >>
  \layout {
    \context {
      \Voice
      \omit StringNumber
    }
    \context {
      \TabVoice
      \consists Bend_spanner_engraver
    }
  }
}
@end lilypond

@end itemize


@node Am√©liorations pour la notation des percussions
@unnumberedsec Am√©liorations pour la notation des percussions
@translationof Percussion improvements

@itemize
@item
Ajout du style de notation pour percussions @code{weinberg-drums-style}
bas√© sur les travaux de standardisation de Norman Weinberg.

@end itemize


@node Am√©liorations pour la notation des instruments √† vent
@unnumberedsec Am√©liorations pour la notation des instruments √† vent
@translationof Wind instrument improvements

@itemize
@item
Des d√©tails peuvent d√©sormais s'ajouter √† un @code{\woodwind-diagram}, y
compris l'angle d'un trou partiellement bouch√© ou l'indication non
graphique d'une cl√© de trille.

@lilypond[verbatim,quote]
\markup {
  \override #'(graphical . #f)
  \override #'(woodwind-diagram-details . ((fill-angle . 90)
                                           (text-trill-circled . #f)))
  \woodwind-diagram #'flute #'((cc . (one1h))
                               (lh . ())
                               (rh . (besT)))
}
@end lilypond

@end itemize


@node Am√©liorations pour la notation des accords
@unnumberedsec Am√©liorations pour la notation des accords
@translationof Chord notation improvements

@itemize
@item
Les grilles harmoniques sont d√©sormais prises en charge.

@lilypond[quote,indent=0\cm,noragged-right]
\new ChordGrid \chordmode {
  g2:7+ bes4:m7 ees:7
  \repeat percent 2 {
    a2:m7 b2:7.11+
  }
  e4:m7 e4:m7/d a4:7/cis c4:m7
}
@end lilypond


@item
Dans un @code{ChordNames}, les silences multimesure forcent d√©sormais
l'apparition du symbole ¬´¬†N.C.¬†¬ª comme pour des silences normaux.


@item
En mati√®re de basse chiffr√©e, un @code{_} cr√©e d√©sormais un un chiffre
vide occupant de l'espace.

@lilypond[verbatim, quote]
\figures {
  <8 _ 4]> <_ 5+ 3>
}
@end lilypond


@item
La mise en forme de la basse chiffr√©e s'est am√©lior√©e. En particulier,
sa taille par d√©faut est r√©duite √† une valeur que l'on retrouve dans
nombre d'√©ditions @emph{Urtext} de musique baroque.


@item
La basse chiffr√©e utilise d√©sormais par d√©faut des glyphes dessin√©s
sp√©cifiquement dans ce cadre, √† savoir les @code{6\\}, @code{7\\} et
@code{9\\}. De m√™me, des glyphes sp√©cifiques seront utilis√©s par d√©faut
en pr√©sence d'un signe plus apr√®s le chiffre pour les symboles
@code{2\+}, @code{4\+} et @code{5\+}.

@lilypond[quote]
\figures {
  \set figuredBassPlusDirection = #RIGHT
  <7\\ 6 4 2\+> <4\+ _-> <3 5\+ 3 > <6\\ 4 3> <9\\>
}
@end lilypond

L'utilisation de ces glypes dans le cadre d'un @emph{markup} s'obtient
√† l'aide de la commande @code{\figured-bass}.

@item
En mati√®re de basse chiffr√©e, il est d√©sormais possible de placer les
alt√©rations entre crochets.

@lilypond[quote]
\figures {
  <7 [5 3[+]]> <5[!]> <[5!]>
}
@end lilypond


@end itemize


@node Am√©liorations pour les notations anciennes
@unnumberedsec Am√©liorations pour les notations anciennes
@translationof Ancient notation improvements

@itemize
@item
Le nouveau contexte  @code{VaticanaLyrics} est similaire au contexte
@code{Lyrics}, √† ceci pr√®s qu'il fournit un style d'hyph√©nation utilis√©
commun√©ment dans le style des √©ditions vaticanes, √† savoir un trait
d'union simple accol√© √† la syllabe de gauche.


@item
Les commandes pr√©d√©finies pour les divisions gr√©goriennes ne sont plus
des variantes de @code{\breathe}. @code{\divisioMinima},
@code{\divisioMaior}, @code{\divisioMaxima} et @code{\virgula} sont des
variantes d'un @code{\caesura} de base. @code{\finalis} √©quivaut √†
@code{\section}.

@code{MensuralStaff} et @code{VaticanaStaff} ont recours au
@code{Divisio_@/engraver} pour interpr√©ter ces commandes, ainsi que
@code{\repeat volta} et @code{\fine}.

@lilypond[verbatim,quote]
\new MensuralStaff \fixed c' {
  \repeat volta 2 { f2 f }
  g1
  a1 \section
  b1 \fine
}
@end lilypond


@item
@code{KievanStaff}, @code{MensuralStaff}, @code{PetrucciStaff} et
@code{VaticanaStaff} acceptent d√©sormais qu'un saut de ligne intervienne
n'importe o√π, sans qu'une barre de mesure @code{""} soit cr√©√©e.


@item
Dans un @code{GregorianTranscriptionStaff}, les @emph{divisiones} sont
d√©sormais grav√©es comme des objets graphiques @emph{(grobs)}
@code{BarLine}. Pour les modifier en @emph{grobs} @code{Divisio}, il
faut mentionner @code{\EnableGregorianDivisiones}.


@item
@code{GregorianTranscriptionStaff} autorise d√©sormais un saut de ligne
ap√®r√®s n'importe quelle note et n'a plus recours au
@code{Time_signature_engraver}.

@item
@code{GregorianTranscriptionVoice} n'a d√©sormais plu recours au
@code{Stem_engraver}.


@end itemize


@subsubheading Am√©liorations pour les musiques du monde

@itemize
@item
LilyPond prend d√©sormais en charge la musique persane. Deux glyphes
d'alt√©ration ont √©t√© ajout√©s √† cet effet¬†: @emph{sori} et @emph{koron}.

@lilypond[verbatim,quote,line-width=14.5\cm]
\include "persian.ly"

\relative c' {
  \key d \chahargah
  bk'8 a gs fo r g ak g |
  fs ek d c d ef16 d c4 |
}
@end lilypond

@end itemize


@node Autres am√©liorations diverses
@unnumbered Autres am√©liorations diverses
@translationof Miscellaneous improvements

@itemize
@item
Dans le cadre de la fonte Emmentaler, les t√™tes de notes dont l'aspect
est identique et pour lesquelles la seule diff√©rence r√©side dans
l'orientation de leur hampe ont √©t√© consolid√©es en un glyphe unique. Par
exemple, les glyphes @code{noteheads@/.u2triangle} et
@code{noteheads@/.d2triangle} ont √©t√© remplac√©s par le seul glyphe
@code{noteheads@/.s2triangle}. Les paires de t√™te de note ayant un aspect
diff√©rent selon l'orientation de la hampe conservent leur distinction.

Par ailleurs, la propri√©t√© @code{stem-attachment} des objets graphiques
@code{NoteHead} renvoie le point d'attachement r√©el selon l'orientation
de hampe en lieu et place d'un hypoth√©tique point d'attachement d'une
hampe ascendante.


@item
Deux glyphes redondants ont √©t√© supprim√©s des fontes Emmentaler¬†:
@code{scripts.trillelement} -- utilisez @code{scripts.trill_element} en
remplacement -- et @code{scripts.augmentum} -- √† remplacer par
@code{dots.dotvaticana}.


@item
L'utilisation de @code{\paper @{ bookpart-level-page-numbering = ##t@}}
permet d'individualiser la num√©rotation de page des parties d'un
ouvrage. Dans le cas o√π l'instruction s'applique √† toutes les parties,
chacune d'entre elles aura sa propre s√©quence, en partant de¬†1 par
d√©faut. Cette instruction peut aussi appara√Ætre dans une partie
sp√©cifique, comme par exemple un propos liminaire dont la pagination
peut accessoirement se pr√©senter en chiffres romains gr√¢ce √†
l'instruction @code{page-number-type = #'roman-lower}.


@item
La nouvelle fonction de rappel pour objet graphique
@code{break-alignment-list} permet de renvoyer une valeur diff√©rente
selon le positionnement d'un @emph{grob} par rapport √† une rupture. Elle
permet, par exemple, de fournir un alignement du @emph{grob} diff√©rent
selon qu'il est positionn√© en d√©but, en cours de ligne ou √† la fin.

@lilypond[quote]
\score {
  { \repeat unfold 8 c' }
  \layout {
    \context {
      \Score
      barNumberVisibility = #all-bar-numbers-visible
      \override BarNumber.break-visibility = #'#(#t #t #t)
      \override BarNumber.self-alignment-X =
        #(break-alignment-list CENTER LEFT CENTER)
    }
  }
}
@end lilypond


@item
Le nouveau @code{Mark_performer} cr√©e des √©v√©nements MIDI √† l'instar du
@code{Mark_engraver} pour les sorties imprimables.


@item
Les propri√©t√©s de @code{PaperColumn} et @code{NonMusicalPaperColumn}
telle que @code{NonMusicalPaperColumn.line-@/break-@/system-@/details}
acceptent d√©sormais des d√©rogations au fil de la musique √† l'aide d'une
simple instruction @code{\once \override}. Elles consituaient
jusqu'alors une exception, requ√©rant l'utilisation de la commande
@code{\overrideProperty}.


@item
Les nouvelles propri√©t√©s @code{show-horizontal-skylines} et
@code{show-vertical-skylines} permettent d'afficher les lignes d'horizon
d'un objet. Ces propri√©t√©s sont beaucoup plus flexibles que
l'utilisation de l'option @code{debug-skylines} dans la mesure o√π elles
sont op√©rationnelles avec tous les objets graphiques. Bien que pr√©vu √†
l'origine pour le d√©bogage de LilyPond, ceci s'av√®re fort utile lorsque
l'on tente de comprendre les d√©cisions en mati√®re d'espacement ou la
modification de stencils en Scheme.

@lilypond[quote]
#(set-global-staff-size 40)

{
  \override Staff.Clef.show-vertical-skylines = ##t
  \override Accidental.show-horizontal-skylines = ##t
  cis'
}
@end lilypond


@item
La nouvelle commande @code{\vshape} se comporte comme @code{\shape}, √†
ceci pr√®s qu'elle affiche les points de contr√¥le et le polygone qui les
enveloppe, afin de faciliter les ajustements.

@lilypond[verbatim,quote]
{ a1\vshape #'((0 . 0) (0 . 0.5) (0 . 0.9) (0 . 0.4))^( c'1) }
@end lilypond


@item
L'instruction @code{\markup \path} est d√©sormais √©galement op√©rationnelle
pour une sortie SVG m√™me si le chemin n'est pas initialis√© par une
commande @code{moveto} ou @code{rmoveto}. Elle accepte par ailleurs les
raccourcis √©quivalents SVG (@code{moveto} = @code{M}, etc.).


@item
@code{set-default-paper-size} et @code{set-paper-size} acceptent
d√©sormais des tailles de papier personnalis√©es.

@example
#(set-default-paper-size '(cons (* 100 mm) (* 50 mm)))
@end example


@item
@command{lilypond-book} prend en charge deux nouvelles options pour le
traitement des extraits¬†: @option{paper-width} et @option{paper-height}
permettent de d√©terminer une taille particuli√®re de papier.


@item
@command{lilypond-book} prend en charge la nouvelle option
@option{inline} pour le traitement d'extraits musicaux. Ceci permet de
faire appara√Ætre des bribes de partition, comme
@lilypond[inline,staffsize=11]{
  { \time 2/4 r8 g'[ g' g'] | es'2 }
}
au sein m√™me d'un paragraphe de texte.


@item
Le script @command{lilypond-book} autorise d√©sormais l'utilisation
d'accolades dans les arguments des commandes @code{\lilypond} (pour
@LaTeX{}) et @code{@@lilypond} (pour Texinfo).


@item
@command{lilypond-book} ajoute d√©sormais le r√©pertoire courant comme
derni√®re entr√©e pour la recherche des fichiers inclus, au lieu de le
placer en premier dans la liste des chemins sp√©cifi√©s. Ainsi, les
fichiers situ√©s dans les dossiers d'inclusion prennent le pas sur
ceux du m√™me nom dans le r√©pertoire courant.  L'effet ne sera visible
que dans le cas o√π existent des fichiers du m√™me nom de part et d'autre.


@item
La nouvelle fonction Scheme @code{universal-@/color} procure une palette
de huit couleurs con√ßue pour lever certaines ambigu√Øt√©s dont souffrent
les gens atteints de dyschromatopsie.

@lilypond[quote]
\markup \bold \column {
  \with-color #(universal-color 'black) black
  \with-color #(universal-color 'orange) orange
  \with-color #(universal-color 'skyblue) skyblue
  \with-color #(universal-color 'bluegreen) bluegreen
  \with-color #(universal-color 'yellow) yellow
  \with-color #(universal-color 'blue) blue
  \with-color #(universal-color 'vermillion) vermillion
  \with-color #(universal-color 'redpurple) redpurple
}
@end lilypond


@item
L'option @code{-dembed-@/source-@/code} permet maintenant d'embarquer
√©galement les images ajout√©es par @code{\epsfile} ainsi que les fichiers
inclus par @code{\verbatim-file}.


@item
La valeur par d√©faut de l'option @code{aux-files} est d√©sormais fix√©e
√†¬†@code{#f}. Lorsque LilyPond est lanc√© avec l'argument
@code{-dbackend=eps} et que sont n√©cessaires les fichiers @file{.tex}
et @file{.texi}, il faut d√©sormais specifier explicitement l'option
@code{-daux-files}. Les formats pour les images @code{lilypond-book}
peuvent se d√©finir s√©par√©ment selon qu'il s'agit de la page (donc une
sortie PNG pour du format HTML) ou des images ind√©pendantes par syst√®me
(pour des formats imprimables EPS ou PDF) √† l'aide respectivement des
sous-options @code{-dtall-page-formats} et
@code{-dseparate-page-formats}.


@item
L'unit√© ¬´¬†big point¬†¬ª (1@dmn{bp} = 1/72@dmn{in}) est d√©sormais
accessible en ajoutant @code{\bp} √† la dimension saisie.


@item
Les traducteurs d√©finis en Scheme et utilisables √† la fois dans le cadre
d'un @samp{\layout} et d'un @samp{\midi} peuvent d√©sormais √™tre cr√©√©s √†
l'aide de @code{make-translator}. Les ex√©cutants d√©finis en Scheme, qui
ne peuvent s'utiliser que dans un @samp{\midi} se cr√©ent √† l'aide de
@code{make-performer}. Ces macros fontionnent tout comme la macro
pr√©existante @code{make-engraver} qui permet de cr√©er un graveur,
uniquement utilisable dans un @samp{\layout}.


@item
Les traducteurs d√©finis en Scheme peuvent d√©sormais d√©finir un nouveau
connecteur d√©nomm√© @code{pre-process-music}. Celui-ci sera appel√© par
tous les traducteurs, apr√®s tous les @emph{listeners} mais pr√©alablement
aux connecteurs @code{process-music}. Ceci peut s'utiliser pour un
traitement qui d√©pend de l'int√©gralit√© des √©v√©nements entendus mais
n√©cessite de d√©finir des propri√©t√©s de contexte avant que d'autres
traducteurs les lisent.


@item
Les traducteurs Scheme peuvent d√©sormais contenir des @emph{listeners}
libell√©s ainsi¬†:

@example
(listeners
 ((event-class engraver event #:once)
  ...))
@end example

Ils ne sont jamais d√©clench√©s plus d'une fois par pas dans le temps. Ils
√©mettront un avertissement lorsqu'ils recevront deux √©v√©nements dans un
m√™me pas, sauf si ces √©v√©nements sont √©quivalents.


@item
Une m√™me d√©finition d'objet graphique peut d√©sormais s'utiliser pour
cr√©er des @emph{grobs} de classe diff√©rente (@code{Item},
@code{Spanner}, @code{Paper_column}, @code{System}). Dans le cadre de
cette √©volution, les types de @emph{grob} @code{FootnoteItem} et
@code{FootnoteSpanner} ont √©t√© rassembl√©s en un unique
type @code{Footnote}. De la m√™me mani√®re, @code{BalloonTextSpanner} et
@code{BalloonTextItem} ont √©t√© unifi√©s en @code{BalloonText}.

Lorsque la d√©finition du @emph{grob} ne requiert pas de classe, les
graveurs doivent d√©cider de la classe √† utiliser pour cr√©er le
@emph{grob}. Pour ceux qui cr√©ent leurs propres graveurs en Scheme, cela
signifie qu'il faudra utiliser soit @code{ly:@/engraver-@/make-@/item},
soit @code{ly:@/engraver-@/make-@/spanner}. La fonction utilitaire
@code{ly:@/engraver-@/make-@/sticky} permet de prendre en charge le cas
des @emph{sticky grobs} tels que notes de bas de page et infobulles.
Elle cr√©e un @emph{grob} de la m√™me classe qu'un autre et g√®re la
parent√© et les attachements.


@item
La nouvelle option @code{-dcompile-scheme-code} pour la ligne de
commande -- on peut aussi l'inclure en t√™te de fichier LilyPond par une
ligne @code{#(ly:set-@/option 'compile-@/scheme-@/code)} -- permet un
meilleur diagnostic lorsque l'ex√©cution de code Scheme provoque une
erreur. En interne, ceci utilise le compilateur de byte fournit par
guile, en lieu et place de l'interpr√©teur.

N√©anmoins, en raison d'une limitation de Guile, il n'est pas possible √†
ce jour de traiter au-del√† de quelques milliers d'expressions Scheme. Il
faut aussi tenir compte du fait que le compilateur de Guile diff√®re
quelque peu de l'interpr√©teur. Par exemple, les parties constantes des
quasicitations sont traduites en constantes r√©elles de mani√®re plus
agressive, ce qui a pour cons√©quence qu'un code comme @code{(let ((x 4))
(sort! `(,x 3 2 1)))} produira une erreur puisque le ¬´¬†cdr¬†¬ª de la liste
quasicit√©e est une constante, et faire subir une mutation √† une donn√©e
litt√©rale est une erreur pour Scheme. (Dans ce cas d'esp√®ce, le code
pourrait √©viter l'erreur s'il avait √©t√© utilis√© un simple @code{sort} --
qui n'est pas destructif -- ou en cr√©ant une nouvelle liste √† chaque
fois avec un @code{(list x 3 2 1)}).

De plus, cette option n'est √† ce jour pas fonctionnelle sur Windows.

@end itemize


@node Notes sur Guile 2.2
@unnumbered Notes sur Guile 2.2
@translationof Notes on Guile 2.2

LilyPond utilise d√©sormais Guile 2.2 au lieu de Guile 1.8.  Cette
section liste quelques unes des incompatibilit√©s que l'on
rencontre le plus fr√©quemment en portant du code √©crit pour Guile
1.8 vers Guile¬†2.2.

Un liste d√©taill√©e des changements apport√©s √† Guile est disponible
dans le fichier
@uref{https://git.savannah.gnu.org/cgit/guile.git/tree/NEWS,
@file{NEWS}} des sources de Guile.

@itemize
@item
La fonction @code{format} requiert un premier argument qui est un
bool√©en ou un port.  Cet argument √©tait facultatif en Guile@tie{}1.8.
Pour que la fonction renvoie la sortie format√©e comme une cha√Æne de
caract√®res, il faut passer @code{#f} pour cet argument, c'est √† dire
utiliser @code{(format #f "@var{cha√Æne}" @var{arguments} @dots{})}
au lieu de @code{(format "@var{cha√Æne}" @var{arguments} @dots{})}.

@item
Les r√®gles sur les d√©finitions internes (les @code{define} qui ne
sont pas au plus haut niveau du fichier mais √† l'int√©rieur
d'autres expressions) sont devenues plus strictes.  En particulier,
on ne peut plus utiliser @code{define} dans certains contextes o√π
une expression est attendue.  √Ä titre d'exemple, ce code n'est
plus valide¬†:

@example
(if (not (defined? 'variable))
    (define variable 'valeur))
@end example

Dans ce cas pr√©cis, une solution est

@example
(define variable
        (if (not (defined? 'variable))
        'valeur
        variable))
@end example


@item
Les cha√Ænes de caract√®res sont d√©sormais constitu√©es de caract√®res Unicode.
Auparavant, un caract√®re Unicode s'√©tendait sur plusieurs caract√®res.
De plus, les fonctions de Guile d√©di√©es au traitement des cha√Ænes de
caract√®res prennent maintenant en charge l'Unicode.

@item
Certaines fonctions num√©riques renvoient des r√©sultats exacts dans
des cas o√π le r√©sultat √©tait auparavant inexact.  Par exemple,
@code{(sqrt 4)} renvoie maintenant @code{2} (un entier) au lieu de
@code{2.0}.

@end itemize


@ifhtml
Pour des annonces plus anciennes, rendez-vouz aux pages
@uref{https://lilypond.org/doc/v2.22/Documentation/changes/},
@uref{https://lilypond.org/doc/v2.20/Documentation/changes/},
ou @uref{../,remontez} √† l'index de la documentation.


@end ifhtml

@bye
