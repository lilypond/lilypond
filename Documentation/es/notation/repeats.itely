@c -*- coding: utf-8; mode: texinfo; documentlanguage: es -*-
@ignore
    Translation of GIT committish: b867930d88612695e07e23dfda1ae35ab1a6ac2a

    When revising a translation, copy the HEAD committish of the
    version that you are working on.  For details, see the Contributors'
    Guide, node Updating translation committishes..
@end ignore

@c \version "2.25.23"


@node Repeats
@chapter Repeticiones

@lilypondfile[quote]{snippets/repeats-headword.ly}

La repetición es un concepto fundamental en música, y existen
varios tipos de notación para las repeticiones.  LilyPond
contempla los siguientes tipos de repetición:

@table @code
@item volta (primera y segunda vez)
Esta es la notación estándar de las repeticiones con o sin finales
alternativos (primera y segunda vez).  La sección que se repite
está encerrada entre barras de repetición, pero la barra inicial
no se escribe cuando la sección que se repite aparece al
prinicipio de la pieza.  Los finales alternativos se imprimen en
secuencia, con líneas de casilla de primera y segunda vez, y
numerados con la repetición o repeticiones a las que se aplican.

@item segno
Este tipo contempla varios casos de @emph{da capo} y @emph{dal
segno}.  La sección que se repite comienza con una marca de segno
mark, excepto si está al comienzo de la pieza.  Los finales
alternativos se imprimen en secuencia y se marcan con símbolos de
coda, y se puede aplicar opcionalmente una etiqueta de sección
como @q{Coda} a la última alternativa.  La sección que se repite
termina con una instrucción como @emph{D.S.}

@item unfold (desplegada)
La música repetida se imprime en su totalidad el número de veces
especificado.

@item percent (porcentaje)
Este tipo consiste en repeticiones de pulsos o compases enteros.
Son como barras inclinadas sueltas o símbolos de porcentaje.

@item tremolo (trémolo)
Este tipo se usa para escribir barras de trémolo.

@end table

Las construcciones de acorde se pueden repetir usando el símbolo
de repetición de acordes, @code{q}.  Véase @ref{Chord repetition}.


@node Long repeats
@section Repeticiones largas

Esta sección trata sobre la forma de introducir repeticiones
largas, normalmente de varios compases.

@node Written-out repeats
@subsection Repeticiones explícitas

@cindex explícita, repeticción
@cindex repetición, explícita
@cindex repetición, desplegada
@cindex desplegada, repetición
@funindex \repeat
@funindex \repeat unfold

La instrucción @code{\repeat unfold} repite la música
escribiéndola entera un cierto número de veces.  La sintaxis es la
misma que la de las instrucciones @code{\repeat volta} y
@code{\repeat segno}, que aparecen documentadas en las secciones
siguientes.

Para evitar la redundancia, el desplegado de repeticiones no se
estudia aquí con mucho detalle; sin embargo, algunos de los
ejemplos de las secciones siguientes ilustran las repeticiones de
varias maneras usando la instrucción @code{\unfoldRepeats} para
convertir las formas @code{volta} o @code{segno} a la forma
@code{unfold}.  Para ver otro importante uso de la instrucción
@code{\unfoldRepeats}, @pxref{Using repeats with MIDI}.

Existen ciertos puntos de interés que son específicos de la
instrucción @code{\repeat unfold}.

En algunos casos, especialmente dentro de un contexto
@code{\relative}, el resultado del despliegue de repeticiones no
es el mismo que el de escribir la expresión musical de entrada
varias veces, p.ej.,

@example
\repeat unfold 2 @{ a'4 b c d | @}
@end example

@noindent
se diferencia de lo siguiente en un cambio de octava:

@example
a'4 b c d |
a'4 b c d |
@end example

También, el anidado de @code{\repeat unfold} puede resultar
práctico de maneras que el anidado de @code{\repeat volta} o
@code{\repeat segno} no lo serían.

@warning{Si se incluye @code{@bs{}relative} dentro de
@code{@bs{}repeat} sin instanciar explícitamente el contexto
@code{Voice}, aparecerán pentagramas extra no deseados.  Véase
@rprogram{An extra staff appears}.}

@morerefs
Fragmentos de código:
@rlsrnamed{Repeats,Repeticiones}.

Referencia de funcionamiento interno:
@rinternals{UnfoldedRepeatedMusic}.
@endmorerefs


@node Simple repeats
@subsection Repeticiones sencillas

@cindex volta
@cindex repetición, sencilla
@funindex \repeat
@funindex \repeat volta

Esta es la sintaxis de una repetición sin variación:

@example
\repeat volta @var{número de veces} @var{expresión}
@end example

@noindent
donde @code{@var{expresión}} es la expresión musical que se ha de
repetir.

@lilypond[verbatim,quote]
\fixed c'' {
  \repeat volta 2 { c2 f }
  R1
  \repeat volta 2 { g2 c }
}
@end lilypond

@cindex repetición, barra de compás al comienzo de la pieza
@cindex volta, repetición, barra de compás al comienzo de la pieza
@cindex barra de compás, para repetición al comienzo de la pieza

De forma predeterminada no se imprimen las dobles barras de
apertura de repetición al principio de una pieza, siguiendo las
convenciones de la tipografía musical clásica.  Sin embargo, sí se
escriben tradicionalmente en ciertos contextos, como en las hojas
guía de acordes para estándares de jazz. Esto se puede conseguir
configurando la propiedad @code{printInitialRepeatBar}.

@lilypond[verbatim,fragment,quote]
\fixed c'' {
  \set Score.printInitialRepeatBar = ##t
  \repeat volta 2 { c2 f }
}
@end lilypond

@cindex repetición, con anacrusa
@cindex anacrusa, en una repetición
@cindex repetición, al alzar
@funindex \partial
@cindex comprobación de compás, con repeticiones
@cindex repetición, con comprobación de compás

Una sección repetida que comienza en mitad de un compás termina
generalmente en la misma posición dentro de un compás posterior de
tal forma que los dos extremos hacen un compás entero.  En estos
casos, las líneas divisorias de repetición no constituyen la
frontera de un compás, por lo que no se debe poner ahí ninguna
comprobación de compás.  De forma similar, no se debe escribir
ninguna instrucción @code{\partial} dentro del fragmento repetido,
porque los compases están completos; sin embargo, hay que escribir
una instrucción @code{\partial} antes de la repetición cuando
aparece un compás verdaderamente incompleto la primera vez.

@lilypond[verbatim,fragment,quote]
\fixed c'' {
  \partial 4
  \repeat volta 2 {
    c4
    c2 d
    g4 g g
  }
  \repeat volta 2 {
    e4
    f2 g
    c2.
  }
}
@end lilypond


@node Alternative endings
@subsection Finales alternativos (primera y segunda vez)

@cindex volta
@cindex prima volta
@cindex seconda volta
@cindex ultima volta
@cindex volta, prima
@cindex volta, seconda
@cindex volta, ultima
@cindex repetición, con finales alternativos
@cindex alternativos, finales
@cindex primera y segunda vez, repetición
@funindex \alternative
@funindex \repeat
@funindex \repeat volta
@funindex \volta

Las repeticiones con finales alternativos de primera y segunda vez
se pueden escribir de dos formas.  Esta es la sintaxis
recomendada:

@example
\repeat volta @var{número_de_veces} @{
  @var{expresión@dots{}}
  \alternative @{
    \volta @var{lista_de_números} @var{expresión}
    \volta @var{lista_de_números} @var{expresión}
    @dots{}
  @}
@}
@end example

@noindent
donde @code{@var{expresión}} es una expresión musical,
@code{@var{expresión@dots{}}} es un número cualquiera de
expresiones musicales, y @code{@var{lista_de_números}} es una
lista, separada por comas, de números de volta (o vez) en el rango
desde 1 hasta @code{@var{número_de_veces}}.

@lilypond[verbatim,quote]
\fixed c'' {
  \repeat volta 6 {
    c4 d e f
    \alternative {
      \volta 1,2,3 { c2 e }
      \volta 4,5 { f2 d }
      \volta 6 { e2 f }
    }
  }
  c1
}
@end lilypond

@noindent
Una sintaxis anterior, en la que el bloque @code{\alternative} se
escribía a continuación fuera de la expresión musical repetida,
aún está contemplada y tiene el mismo efecto.  Esta sintaxis
requiere que @code{\repeat} aparezca literalmente: una cláusula
@code{\alternative} escrita después no se enlaza con una función
musical ni variable que contenga @code{\repeat}.

@example
\repeat volta @var{número_de_veces} @var{expresión}
\alternative @{
  \volta @var{lista_de_números} @var{expresión}
  \volta @var{lista_de_números} @var{expresión}
  @dots{}
@}
@end example

Las especificaciones de @code{\volta} dentro de un bloque
@code{\alternative} son opcionales según el criterio de todos o
ninguno.  Si se omiten, las alternativas se usan una vez cada una,
pero la primera se repite las veces necesarias para que se cumpla
el número de veces de la repetición.

@lilypond[verbatim,quote]
\fixed c'' {
  \repeat volta 6 {
    c4 d e f
    \alternative {
      { c2 e }
      { f2 d }
      { e2 f }
    }
  }
  c1
}
@end lilypond

Los bloques @code{\alternative} se pueden anidar unos dentro de
otros.

@lilypond[verbatim,quote]
music = \fixed c' {
  \repeat volta 3 {
    s1_"A"
    \alternative {
      \volta 1 { s1_"B" }
      \volta 2,3 {
        \once \override Score.VoltaBracket.musical-length =
          \musicLength 1
        s1_"C"
        s1_"D"
        \alternative {
          \volta 2 { s1_"E" }
          \volta 3 { s1_"F" }
        }
      }
    }
  }
  \fine
}

\score { \music }
\score { \unfoldRepeats \music }
@end lilypond


@warning{Cada elemento de un bloque @code{@bs{}alternative} se
trata como un final alternativo.  Algo tan simple como una
comprobación de compás en el lado incorrecto de una llave puede
producir resultados inesperados.}

@warning{Si incluye @code{@bs{}relative} dentro de un
@code{@bs{}repeat} sin crear explícitamente una instancia del
contexto @code{Voice}, aparecerán pentagramas añadidos e
indeseados.  Véase @rprogram{An extra staff appears}.}

@warning{Cuando se habilita una numeración alternativa para los
compases, se aplica a las alternativas encerradas entre llaves que
están en la parte más externa.}


@node Other variation in repeated sections
@subsection Otras variantes dentro de las secciones repetidas

@funindex \alternative
@funindex \unfolded
@funindex \unfoldRepeats
@funindex \volta

Un bloque @code{\alternative} se puede usar dentro de un bloque
@code{\repeat} para producir una notación similar a los finales
alternativos (@pxref{Alternative endings}).

@lilypond[verbatim,quote]
\fixed c'' {
  \repeat volta 2 {
    R1
    \alternative {
      \volta 1 { c1 }
      \volta 2 { d1 }
    }
    R1
  }
}
@end lilypond

La instrucción @code{\volta} no se limita a su uso sobre los
elementos de un bloque @code{\alternative}.  Se puede emplear en
cualquier lugar dentro de @code{\repeat} para designar música para
algunas vueltas en particular, aunque no crea casillas de
repetición de primera y segunda vez en otros casos.

Cuando se despliega un @code{\repeat}, se omite la música
específica de los finales alternativos de todas aquellas vueltas a
las que no se aplica.  Si se da una lista vacía de Scheme en lugar
de los números de repetición, la música desaparece por completo.

@lilypond[verbatim,quote]
music = \repeat volta 3 {
  \volta #'() { <>^\markup { \bold "3×" } }
  \volta 1 { <>_\markup { \italic dolce } }
  g''1
}

\score { \music }
\score { \unfoldRepeats \music }
@end lilypond

Cuando se despliega un @code{\repeat}, puede ser deseable no solo
filtrar toda la música que no es específica de los finales
alternativos, sino también añadir la música que no estaba presente
en la forma plegada.  La instrucción @code{\unfolded} designa la
música que queremos que se ignore hasta que se despliegue el
@code{\repeat} que lo encierra.

@lilypond[verbatim,quote]
music = \fixed c' {
  \repeat volta 2 {
    c1
    <<
      \volta #'() {
        \once \override TextSpanner.bound-details.left.text =
          "2nd time tacet"
        s4*7\startTextSpan s4\stopTextSpan
      }
      \volta 1 { f4 f f f | f f f f }
      \volta 2 { \unfolded { R1*2 } }
    >>
    c'1
  }
  \fine
}

\score { \music }
\score { \unfoldRepeats \music }
@end lilypond

@warning{las instrucciones @code{@bs{}volta} y
@code{@bs{}unfolded} funcionan con respecto a la repetición más
interior que las incluye.}


@node Al-fine repeats
@subsection Repeticiones Al fine

@funindex \fine

La instrucción @code{\fine} marca el final de la música pero no
obliga a que lo sea.  Cuando se despliega una repetición que
contiene @code{\fine}, la instrucción @code{\fine} se despliega
como cualquier otra música.  Para obtener un desplegado correcto,
es necesario especificar el final alternativo en que se debe
ejecutar el @emph{Fine} y los finales alternativos en los que toda
música que aparezca a continuación deba ser ejecutada
(@pxref{Other variation in repeated sections}).

@lilypond[quote,verbatim]
music = \fixed c' {
  \repeat volta 2 {
    f1
    \volta 2 \fine
    \volta 1 b1
  }
}

\score { \music }
\score { \unfoldRepeats \music }
@end lilypond

Como se acaba de mostrar, en el final escrito de la música,
@code{\fine} crea una barra de compás de final sin ninguna
indicación de @emph{Fine}.  Para forzar que aparezca el
@emph{Fine} en estos casos, establezca a verdadero el valor de la
propiedad de contexto @code{finalFineTextVisibility}.

@lilypond[quote,verbatim]
\fixed c' {
  \set Score.finalFineTextVisibility = ##t
  f1
  \fine
}
@end lilypond

Para modificar el texto que imprime la instrucción @code{\fine},
configure el valor de la propiedad de contexto @code{fineText}.

@lilypond[quote,verbatim]
\fixed c' {
  \set Score.fineText = "Fine."
  \repeat volta 2 {
    f1
    \volta 2 \fine
    \volta 1 b1
  }
}
@end lilypond

Para ver más detalles acerca de las interacciones con otros tipos
de líneas divisorias y opciones para modificar su aspecto,
@pxref{Automatic bar lines}.

@morerefs
Glosario musical:
@rglos{fine}.

Referencia de la notación:
@ref{Automatic bar lines},
@ref{Other variation in repeated sections},
@ref{Section divisions}.

Fragmentos de código:
@rlsrnamed{Repeats,Repeticiones}.

Referencia de funcionamiento interno:
@rinternals{FineEvent},
@rinternals{Jump_engraver},
@rinternals{JumpScript}.
@endmorerefs


@node Segno repeat structure
@subsection Estructura de las repeticiones de Segno

@cindex @q{coda}, signo, con repeticiones
@cindex @q{segno} signo, con repeticiones
@cindex signo, coda, con repeticiones
@cindex signo, segno, con repeticiones
@funindex \repeat segno

@code{\repeat segno} se diferencia de @code{\repeat volta} solo en
la notación que resulta impresa.  Consulte las secciones
anteriores para ver información general sobre la escritura de
música con repeticiones, finales alternativos y variaciones.  Esta
sección se ocupa de los detalles de la notación de segno sin
volver a explicar la sintaxis del código de entrada.

@code{\repeat segno} efectúa la notación de las repeticiones que
tienen indicaciones @emph{D.C.} o @emph{D.S.}.  Marca con un
símbolo de segno el comienzo de la sección que se repite cuando no
está al comienzo de la pieza.  También marca los finales
alternativos con símbolos de coda en lugar de casillas de primera
y segunda vez, siempre que los finales se suponga que se ejecutan
en orden, esto es, no @code{\volta 1,3} y después @code{\volta
2,4}.

Cuando se habilita la numeración de compases de los finales
alternativos, también se aplica a las alternativas cuya notación
presenta casillas de primera y segunda vez si se han creado con
@code{\repeat segno} o con @code{\repeat volta}, pero no se aplica
a los finales alternativos que contienen símbolos de coda.

A continuación aparecen muestras de algunos usos comunes.

@quotation
@table @emph

@item al fine
@cindex al fine
@cindex fine
@cindex repeat, al fine
@funindex \fine

Las indicaciones de repetición incluyen @emph{al Fine} si aparece
una instrucción @code{\fine} en cualquier momento anterior
(@pxref{Al-fine repeats}).

@lilypond[quote,verbatim]
music = \fixed c' {
  f1
  \repeat segno 2 {
    g1
    \volta 2 \fine
    \volta 1 a1
  }
  \section
}

\score { \music }
\score { \unfoldRepeats \music }
@end lilypond

@item alla coda
@cindex al coda
@cindex alla coda
@cindex coda
@cindex repetición, alla coda
@cindex repetición, e poi la coda
@funindex \sectionLabel

El comienzo de cada final alternativo se marca con un
@code{\codaMark \default} implícito.  Las indicaciones de
repetición dentro de las alternativas incluyen
@q{@emph{al@tie{}@dots{} e poi la@tie{}@dots{}}} que se refiere a
la marca de la primera alternativa y la marca a la que se salta.
Si la duración de la última alternativa sea cero, se suprime la
llamada automática, permitiendo en su lugar establecer una
etiqueta de sección.

@lilypond[quote,verbatim,line-width=12.0\cm]
music = \fixed c' {
  f1
  \repeat segno 2 {
    g1
    \alternative {
      \volta 1 { \repeat unfold 4 { a2 } }
      \volta 2 \volta #'() {
        \section
        \sectionLabel "Coda"
      }
    }
  }
  b1
  \fine
}

\score { \music }
\score { \unfoldRepeats \music }
@end lilypond

Se puede abreviar la indicacion de retorno preparando un
procedimiento de formato alternativo (@pxref{Segno repeat
appearance}).

@item da capo
@cindex D.C.
@cindex da capo
@cindex repetición, D.C.
@cindex repetición, da capo

Las indicaciones de repetición incluyen @emph{D.C.} cuando la
sección que se repite comienza al principio de la partitura.  Los
casos contemplados de @emph{da capo} reflejan los casos
contemplados de @emph{dal segno}.

@lilypond[quote,verbatim]
music = \fixed c' {
  \repeat segno 2 {
    g1
  }
  \fine
}

\score { \music }
\score { \unfoldRepeats \music }
@end lilypond

@item dal segno
@cindex D.S.
@cindex dal segno
@cindex repeat, D.S.
@cindex repeat, dal segno
@cindex segno

Las indicaciones de repetición incluyen @emph{D.S.} cuando la
sección que se repite comienza después del principio de la
partitura.  El comienzo de la sección que se repite viene marcada
con una llamada @code{\segnoMark \default} implícita.

@lilypond[quote,verbatim]
music = \fixed c' {
  f1
  \repeat segno 2 {
    g1
  }
  \repeat segno 2 {
    a1
  }
  \fine
}

\score { \music }
\score { \unfoldRepeats \music }
@end lilypond

@noindent
Se puede forzar una repetición del tipo @emph{dal-segno} que
comience al principio de la partitura (@pxref{Segno repeat
appearance}).

@item retorno múltiple
Una indicación de repetición que se debe ejecutar más de una vez
incluye una @q{@emph{@dots{}@tie{}V.}}.  El número de veces que la
indicación se ejecuta es una menos que el número de veces que se
ejecuta el pasaje completo.

@lilypond[quote,verbatim]
music = \fixed c' {
  \repeat segno 3 {
    g1
  }
  \fine
}

\score { \music }
\score { \unfoldRepeats \music }
@end lilypond
@end table
@end quotation

@morerefs
Glosario musical:
@rglos{da capo},
@rglos{dal segno},
@rglos{fine}.

Referencia de la notación:
@ref{Al-fine repeats},
@ref{Alternative endings},
@ref{Automatic bar lines},
@ref{Other variation in repeated sections},
@ref{Section divisions},
@ref{Section labels},
@ref{Simple repeats}.

Fragmentos de código:
@rlsrnamed{Repeats,Repeticiones}.

Referencia de funcionamiento interno:
@rinternals{CodaMark},
@rinternals{JumpScript},
@rinternals{SectionLabel},
@rinternals{SegnoMark}.
@endmorerefs


@node Segno repeat appearance
@subsection Apariencia de las repeticiones de Segno

@funindex \codaMark
@funindex \segnoMark
@cindex barra de compás, segno
@cindex repetición, con segno
@cindex segno, barra de compás
@cindex signo, barra de compás
@cindex signo, con repeticiones

Las indicaciones de llamada y retorno que crea la instrucción
@code{\repeat segno} son ajustables en ciertos aspectos.

Las indicaciones de retorno se formatexn con el procedimiento de
Scheme especificado en la propiedad
@code{dalSegnoTextFormatter}. Hay un formateador alternativo
predefinido que crea indicaciones más breves.

@lilypond[quote,verbatim]
\fixed c' {
  \set Score.dalSegnoTextFormatter = #format-dal-segno-text-brief
  f1
  \repeat segno 2 {
    g1
    \alternative {
      \volta 1 { a1 }
      \volta 2 \volta #'() {
        \section
        \sectionLabel "Coda"
      }
    }
  }
  b1
  \fine
}
@end lilypond

@cindex D.S., forzado al comienzo
@cindex dal segno, forzado al comienzo
@cindex repetición, D.S., forzado al comienzo
@cindex repetición, dal segno, forzado al comienzo
@cindex segno, forzado al comienzo
Los números de secuencia de las llamadas al principio de la
sección que se repite y el comienzo de la primera alternativa se
deben fijar explícitamente sin que interfieran con las
indicaciones de retorno automáticas (@pxref{Manual repeat marks}).

@lilypond[quote,verbatim]
\fixed c' {
  \repeat segno 2 {
    \volta #'() { \segnoMark 2 }
    g1
    \alternative {
      \volta 1 {
        \volta #'() { \codaMark 2 }
        \repeat unfold 8 { a4 }
      }
      \volta 2 \volta #'() {
        \section
        \sectionLabel "Coda"
      }
    }
  }
  b1
  \fine
}
@end lilypond

@noindent
Sin la instrucción @code{\segnoMark 2} explícita, el ejemplo
anterior se habría impreso como una repetición del tipo
@emph{da-capo}.

Como alternativa a la impresión de un símbolo de segno como
llamada encima del pentagrama, es posible imprimirlo como una
línea divisoria estableciendo el valor de la propiedad
@code{segnoStyle} a @code{bar-line}.  Para evitar la ambigüedad,
solo permanece sin llamada el primer compás de segno.

@lilypond[verbatim,quote]
\fixed c' {
  \set Score.segnoStyle = #'bar-line
  R1
  \repeat unfold 3 {
    \repeat segno 2 {
      R1*2
    }
  }
  \fine
}
@end lilypond

Allí donde un compás de segno coincide con otras líneas divisorias
especiales, se selecciona automáticamente una línea de compás a
partir de un conjunto predeterminado.  Para cada combinación que
se contempla, la línea divisoria se puede personalizar
configurando una cierta propiedad de contexto (@pxref{Automatic
bar lines}).

Las llamadas de segno y coda se formatean con procedimientos
especificados en las propiedades @code{segnoMarkFormatter} y
@code{codaMarkFormatter}.  Estos son intercambiables con los
procedimientos usados para formatear las llamadas de ensayo
(@pxref{Rehearsal marks}).

@lilypond[verbatim,quote]
\fixed c' {
  \set Score.segnoMarkFormatter = #format-mark-numbers
  \set Score.segnoStyle = #'bar-line
  R1
  \repeat unfold 3 {
    \repeat segno 2 {
      R1*2
    }
  }
  \fine
}
@end lilypond

Hay un formateador alternativo predefinido para el segno que
imprime una llamada incluso sobre la primera línea divisoria:

@lilypond[verbatim,quote]
\fixed c' {
  \set Score.segnoMarkFormatter = #format-segno-mark
  \set Score.segnoStyle = #'bar-line
  R1
  \repeat unfold 3 {
    \segnoMark \default
    R1*2
  }
}
@end lilypond

@cindex @q{coda}, variante del signo
@cindex signo, coda, variante
@cindex variante del signo @q{coda}

También hay un formateador alternativo predefinido de llamadas de
coda que usa símbolos de @code{\varcoda}.

@lilypond[verbatim,quote]
\fixed c' {
  \set Score.codaMarkFormatter = #format-varcoda-mark
  R1
  \repeat unfold 3 {
    \codaMark \default
    R1*2
  }
}
@end lilypond

@snippets

@cindex primera y segunda vez, acortar casilla
@cindex acortar, casillas de primera y segunda vez
@lilypondfile[verbatim,quote,texidoc,doctitle]
{snippets/shortening-volta-brackets.ly}

@cindex primera y segunda vez, casillas en pautas adicionales
@funindex Volta_engraver
@lilypondfile[verbatim,quote,texidoc,doctitle]
{snippets/volta-brackets-in-multiple-staves.ly}

@cindex repetición, letras y números de compás
@cindex repetición, números de compás de primera y segunda vez
@cindex repetición, números de compás alternativos
@cindex número de compás, alternativo, en repetición
@lilypondfile[verbatim,quote,texidoc,doctitle]
{snippets/alternative-bar-numbering.ly}


@morerefs
Glosario musical:
@rglos{repeat},
@rglos{volta}.

Referencia de la notación:
@ref{Automatic bar lines},
@ref{Bar lines},
@ref{Modifying context plug-ins},
@ref{Modifying ties and slurs},
@ref{Time administration}.

Archivos instalados:
@file{ly/engraver-init.ly}.

Fragmentos de código:
@rlsrnamed{Repeats,Repeticiones}.

Referencia de funcionamiento interno:
@rinternals{VoltaBracket},
@rinternals{VoltaRepeatedMusic},
@rinternals{UnfoldedRepeatedMusic}.
@endmorerefs

@knownissues
@cindex repetición, ambigua
@cindex anidada, repetición
@cindex repetición, anidada
@cindex repetición, contador de tiempo de la
@cindex repetición, y números de compás
@cindex número de compás y repeticiones
@cindex tiempo, repeticiones y contador de
@cindex compás, repeticiones y números de
@cindex repetición, y ligadura de expresión
@cindex ligadura de expresión y repeticiones
@cindex glissando, y repeticiones
@cindex repetición, y glissando

Para las repeticiones en la forma @code{volta} (primera y segunda
vez), los elementos extensos (ligaduras de expresión, etc.@:) que
atraviesan los límites de las alternativas funcionan solo para la
primera alternativa.  De igual forma, no pueden abarcar desde el
final de una alternativa hacia atrás hasta el comienzo de la
sección que se repite.

La apariencia visual de una ligadura de unión o de expresión que
continúa en alternativas subsecuentes se puede conseguir con la
instrucción @code{\repeatTie} si la ligadura se extiende solo
sobre una nota dentro del bloque alternativo, aunque este método
no funciona en @code{TabStaff}; @pxref{Repeat tie}.  Otros métodos
que se pueden confeccionar para indicar ligaduras que se continúan
sobre varias notas dentro de los bloques alternativos, y que
también funcionan en los contextos @code{TabStaff}, se muestran en
@ref{Modifying ties and slurs}.

La apariencia visual de un glissando que continúa en las casillas
de alternativa se puede conseguir como un glissando que comienza
en una nota de adorno oculta.  @xref{Extending glissandi across
repeats}.

Si una repetición que comienza en un compás incompleto tiene un
bloque @code{\alternative} que contiene modificaciones a la
propiedad @code{measureLength}, el uso de @code{\unfoldRepeats}
dará lugar a líneas divisorias descolocadas y advertencias de
comprobación de compás.

Una repetición anidada que usa la sintaxis antigua
@code{\alternative} es ambigua:

@example
\repeat @dots{}
\repeat @dots{}
\alternative
@end example

@noindent
No está claro a qué @code{\repeat} pertenece la
@code{\alternative}.  Esta ambigüedad se resuelve haciendo que la
@code{\alternative} pertenezca siempre a la @code{\repeat} más
interna.  Para más claridad, se recomienda usar llaves y poner el
bloque @code{\alternative} dentro del cuerpo de su propia
repetición.


@node Manual repeat marks
@subsection Marcas de repetición manual


@cindex manual, marca de repetición
@cindex repetición manual
@cindex comienzo de repetición
@cindex repetición, comienzo de
@cindex final de repetición
@cindex repetición, final de
@cindex repetición, cambiar número de
@cindex repetición, cambiar finales alternativos
@cindex casillas de primera y segunda vez
@funindex repeatCommands
@funindex start-repeat

@warning{Estos métodos solo se utilizan para realizar
construcciones de repetición poco usuales, y pueden tener un
comportamiento distinto al esperado.  En casi todas las
situaciones, se deben crear las repeticiones utilizando la
instrucción estándar @code{@bs{}repeat} o imprimiendo las barras
de compás correspondientes.  Para ver más información, consulte
@ref{Bar lines}.}

Se puede usar la propiedad @code{repeatCommands} para controlar la
disposición de las repeticiones.  Su valor es una lista de Scheme.
En general, cada elemento es a su vez una lista,
@code{'(@var{instrucción} @var{argumentos@dots{}})}, pero una
lista sin argumentos se puede abreviar como un símbolo; p.ej.,
@code{'((start-@/repeat))} se puede escribir como
@code{'(start-@/repeat)}.

@table @code
@item end-repeat
Termina una sección repetida.

@lilypond[verbatim,quote]
\relative {
  c''1
  d4 e f g
  \set Score.repeatCommands = #'(end-repeat)
  c1
}
@end lilypond

@item start-repeat
Inicia una sección repetida.

@lilypond[verbatim,quote]
\relative {
  c''1
  \set Score.repeatCommands = #'(start-repeat)
  d4 e f g
  c1
}
@end lilypond

En la práctica habitual del grabado no se imprimen signos de
repetición al principio de la pieza.

@item volta @var{texto}
Si @var{texto} es un elemento de marcado, iniciar una casilla de
alternativa con esa etiqueta; si @var{texto} es @code{#f},
terminar la casilla de alternativa.  Una casilla de volta o
alternativa que no se hace terminar explícitamente no llegará a
imrpimirse.

@lilypond[verbatim,quote]
\relative {
  f''4 g a b
  \set Score.repeatCommands =
    #`((volta ,#{ \markup \volta-number "2" #}))
  g4 a g a
  \set Score.repeatCommands = #'((volta #f))
  c1
}
@end lilypond

@end table

Se pueden producir varias instrucciones de repetición en el mismo
punto:

@lilypond[verbatim,quote]
\relative {
  f''4 g a b
  \set Score.repeatCommands =
    #`((volta ,#{ \markup { \concat { \volta-number 2 , }
                            \volta-number 5 } #})
       end-repeat)
  g4 a g a
  c1
  \set Score.repeatCommands =
    #`((volta #f)
       (volta ,#{ \markup \volta-number 95 #})
       end-repeat)
  b1
  \set Score.repeatCommands = #'((volta #f))
}
@end lilypond

@cindex casilla, de repetición, con texto
@cindex texto, en casilla de repetición

Se puede incluir texto dentro de la casilla de primera y segunda
vez.  El texto puede ser un número o números, o un elemento de
marcado, véase @ref{Formatting text}.  La forma más fácil de usar
texto de marcado es definir el marcado previamente, y luego
incluirlo dentro de una lista de Scheme.

@lilypond[verbatim,quote]
voltaAdLib = \markup { \volta-number { 1. 2. 3... }
                       \italic { ad lib. } }
\relative {
  c''1
  \set Score.repeatCommands = #`((volta ,voltaAdLib) start-repeat)
  c4 b d e
  \set Score.repeatCommands =
    #`((volta #f)
       (volta ,#{ \markup \volta-number "4." #})
       end-repeat)
  f1
  \set Score.repeatCommands = #'((volta #f))
}
@end lilypond

@cindex @q{coda}, signo manual
@cindex @q{segno}, signo manual
@cindex signo, coda, manual
@cindex signo, segno, manual
@funindex \codaMark
@funindex \inStaffSegno
@funindex \segnoMark

Se pueden crear llamadas de segno y coda con las instrucciones
@code{\segnoMark}, @code{\inStaffSegno} y @code{\codaMark}.  Esta
es la sintaxis para las instrucciones de llamada:

@example
\codaMark @var{n}
\segnoMark @var{n}
@end example

@noindent
donde @code{@var{n}} es un número de secuencia, o @code{\default}
para usar el siguiente automáticamente.  Las llamadas de ensayo,
de segno y de coda se numeran de manera independiente.

@lilypond[verbatim,quote]
\fixed c' {
  e1
  \segnoMark \default
  e1
  \segnoMark \default
  g1
  \codaMark \default
  g1
  \codaMark \default
  b1
  \codaMark 96
  b1
  \segnoMark 96
}
@end lilypond

@cindex segno, forzado al inicio
Al comienzo de una pieza, las instrucciones @code{\segnoMark
\default} y @code{\codaMark \default} no producen ningún símbolo
de llamada.  Especifique @samp{1} para forzar una llamada.

@lilypond[verbatim,quote]
\fixed c' {
  \segnoMark 1
  f1
}
@end lilypond

La instrucción @code{\inStaffSegno} es equivalente a
@code{\segnoMark \default} con el efecto añadido de establecer
temporalmente la propiedad @code{segnoStyle} al valor
@code{bar-line} para forzar que se imprima como una barra de
compás.

@lilypond[verbatim,quote]
\fixed c' {
  e1
  \inStaffSegno
  g1
  \segnoMark \default
  b1
}
@end lilypond

Para ver más información acerca de cómo modificar la aperiencia
visual de las llamadas de segno y coda, @pxref{Segno repeat
appearance}.

@cindex D.C., manual
@cindex D.S., manual
@cindex da capo, manual
@cindex dal segno, manual
@cindex repetición, D.C., manual
@cindex repetición, D.S., manual
@cindex repetición, da capo, manual
@cindex repetición, dal segno, manual
@funindex \jump

Para crear indicaciones de salto arbitrarias, use la instrucción
@code{\jump}.

@lilypond[verbatim,quote]
\fixed c' {
  \time 2/4
  f4 a
  b4 c'8 d'
  c'4 c
  \jump "Gavotte I D.C."
  \section
}
@end lilypond

@morerefs
Referencia de la notación:
@ref{Bar lines},
@ref{Formatting text},
@ref{Rehearsal marks},
@ref{Segno repeat appearance}.

Fragmentos de código:
@rlsrnamed{Repeats,Repeticiones}.

Referencia de funcionamiento interno:
@rinternals{CodaMark},
@rinternals{Jump_engraver},
@rinternals{JumpScript},
@rinternals{Mark_engraver},
@rinternals{SegnoMark},
@rinternals{SegnoRepeatedMusic},
@rinternals{VoltaBracket},
@rinternals{VoltaRepeatedMusic}.
@endmorerefs


@node Short repeats
@section Repeticiones cortas

Esta sección trata de cómo introducir repeticiones cortas.  Las
repeticiones cortas pueden adoptar dos formas: barras inclinadas o
signos de porcentaje si estamos representando repeticiones de una
sola nota, un compás o dos compases, y trémolos en caso contrario.

@node Percent repeats
@subsection Repeticiones de compás o parte de ellos

@cindex repetición, de pulso
@cindex repetición, de porcentaje
@cindex repetición, de compás
@cindex repetición, de barra inclinada
@cindex pulso, repetición
@cindex porcentaje, repetición
@cindex compás, repetición
@cindex repetición, corta
@cindex barra inclinada, repetición
@funindex \repeat percent

Los patrones cortos que se repiten se imprimen una sola vez, y el
patrón repetido se sustituye por un símbolo especial.

La sintaxis es:

@example
\repeat percent @var{número} @var{expresión_musical}
@end example

@noindent
donde @code{@var{expresión_musical}} es una expresión musical.

Los patrones más cortos que un compás se sustituyen por barras
inclinadas.

@lilypond[verbatim,quote]
\relative c'' {
  \repeat percent 4 { c128 d e f }
  \repeat percent 4 { c64 d e f }
  \repeat percent 5 { c32 d e f }
  \repeat percent 4 { c16 d e f }
  \repeat percent 4 { c8 d }
  \repeat percent 4 { c4 }
  \repeat percent 2 { c2 }
}
@end lilypond

Los patrones de repetición de uno o dos compases se sustituyen por
signos parecidos al símbolo de porcentaje.

@lilypond[verbatim,quote]
\relative c'' {
  \repeat percent 2 { c4 d e f }
  \repeat percent 2 { c2 d }
  \repeat percent 2 { c1 }
}
@end lilypond

@lilypond[verbatim,quote]
\relative {
  \repeat percent 3 { c''4 d e f | c2 g' }
}
@end lilypond

@funindex \after

Observe que el tiempo de desplazamiento correcto para acceder al
grob @code{DoublePercentRepeat} es el comienzo del segundo compás
de la repetición, que se puede conseguir fácilmente con
@code{\after}.

@lilypond[verbatim,quote]
\new Voice \with { \consists Balloon_engraver }
  { \after 1*3
      \balloonGrobText DoublePercentRepeat #'(-1 . 2) "repeat"
    \repeat percent 2 { g'1 | a'1 } }
@end lilypond

Los patrones más cortos que un compás pero que contienen
duraciones mezcladas utilizan un símbolo de porcentaje doble.

@lilypond[verbatim,quote]
\relative {
  \repeat percent 4 { c''8. <d f>16 }
  \repeat percent 2 { \tuplet 3/2 { r8 c d } e4 }
}
@end lilypond


@snippets

@cindex porcentaje, contador de repetición
@cindex contador, repetición de porcentaje
@cindex repetición, contador, porcentaje
@funindex countPercentRepeats
@lilypondfile[verbatim,quote,texidoc,doctitle]
{snippets/percent-repeat-counter.ly}

@cindex porcentaje, repetición, visibilidad del contador
@cindex contador, visibilidad de repetición de porcentaje
@cindex repetición, porcentaje, visibilidad del contador
@funindex repeatCountVisibility
@lilypondfile[verbatim,quote,texidoc,doctitle]
{snippets/percent-repeat-count-visibility.ly}

@cindex porcentaje, repetición, aislada
@cindex repetición, porcentaje, aislada
@lilypondfile[verbatim,quote,texidoc,doctitle]
{snippets/isolated-percent-repeats.ly}


@morerefs
Glosario musical:
@rglos{percent repeat},
@rglos{simile}.

Fragmentos de código:
@rlsrnamed{Repeats,Repeticiones}.

Referencia de funcionamiento interno:
@rinternals{RepeatSlash},
@rinternals{RepeatSlashEvent},
@rinternals{DoubleRepeatSlash},
@rinternals{PercentRepeat},
@rinternals{PercentRepeatCounter},
@rinternals{PercentRepeatedMusic},
@rinternals{Percent_repeat_engraver},
@rinternals{DoublePercentEvent},
@rinternals{DoublePercentRepeat},
@rinternals{DoublePercentRepeatCounter},
@rinternals{Double_percent_repeat_engraver},
@rinternals{Slash_repeat_engraver}.
@endmorerefs

@knownissues
Las repeticiones de porcentaje no contienen nada más aparte del
propio signo de porcentaje; especialmente, los cambios de
indicación de compás no se repiten.

@lilypond[quote,verbatim,relative=2]
\repeat percent 3 { \time 5/4 c2. 2 \time 4/4 2 2 }
@end lilypond

@noindent
Cualquier cambio de compás o instrucción @code{\partial} se tiene
que producir en pasajes paralelos @emph{fuera} de la repetición de
porcentaje, p. ej. en una pista especial para la gestión del
compás.

@lilypond[quote,verbatim,relative=2]
<<
  \repeat percent 3 { c2. 2 2 2 }
  \repeat unfold 3 { \time 5/4 s4*5 \time 4/4 s1 }
>>
@end lilypond


@node Tremolo repeats
@subsection Repeticiones de trémolo

@cindex trémolo
@cindex barra, de trémolo
@cindex repetición, de trémolo
@funindex \repeat tremolo

Los trémolos pueden adoptar dos formas: alternancia entre dos
acordes o dos notas, y repetición rápida de una sola nota o
acorde.  Los trémolos que consisten en una alternancia se indican
por medio de la adición de barras entre las notas o acordes que se
alternan, mientras que los trémolos que consisten en la repetición
rápida de una sola nota se indican mediante la adición de barras
cruzadas a una nota única.

Para colocar marcas de trémolo entre las notas, use @code{\repeat}
con el estilo @code{tremolo} (trémolo):

@lilypond[quote,verbatim]
\relative c'' {
  \repeat tremolo 8 { c16 d }
  \repeat tremolo 6 { c16 d }
  \repeat tremolo 2 { c16 d }
}
@end lilypond

La sintaxis de @code{\repeat tremolo} espera que se escriban
exactamente dos notas dentro de las llaves, y el número de
repeticiones debe corresponderse con un valor que se pueda
expresar con figuras normales o con puntillo.  Así, @code{\repeat
tremolo 7} es válido y produce una nota con doble puntillo, pero
@code{\repeat tremolo 9} no es válido.

La duración del trémolo es igual a la duración de la expresión
entre llaves, multiplicada por el número de repeticiones:
@code{\repeat tremolo 8 @{ c16 d16 @}} da como resultado un
trémolo de redonda, escrito como dos redondas unidas por barras de
trémolo.

Existen dos maneras de colocar marcas de trémolo sobre una única
nota.  Incluso aquí se puede utilizar la sintaxis @code{\repeat
tremolo}, en cuyo caso la nota no debe ir encerrada entre llaves:

@lilypond[quote,verbatim,ragged-right]
\repeat tremolo 4 c'16
@end lilypond

@cindex trémolo, indicación de
@funindex :

El mismo resultado se puede obtener escribiendo @code{:@var{N}}
después de la nota, donde @code{@var{N}} indica la duración de la
subdivisión (debe ser 8 como mínimo).  Si @code{@var{N}} es 8, se
añade una barra de corchea a la plica de la nota.  Si
@code{@var{N}} se omite, se utiliza el último valor:

@lilypond[quote,verbatim]
\relative {
  c''2:8 c:32
  c: c:
}
@end lilypond


@snippets

@cindex trémolo, pentagrama cruzado
@cindex pentagrama, cruzado, trémolo de
@lilypondfile[verbatim,quote,texidoc,doctitle]
{snippets/cross-staff-tremolos.ly}

@lilypondfile[verbatim,quote,texidoc,doctitle]
{snippets/controlling-the-appearance-of-tremolo-slashes.ly}


@morerefs
Fragmentos de código:
@rlsrnamed{Repeats,Repeticiones}.
@endmorerefs


@knownissues
Aunque la sintaxis de @code{\repeat tremolo} se despliega por
medio de @code{\unfoldRepeats}, su abreviatura correspondiente no
lo hace (el seguimiento de este problema está en el
@uref{https://gitlab.com/lilypond/lilypond/-/issues/6145, bug número 6145}):

@lilypond[quote,verbatim]
{
  \unfoldRepeats \repeat tremolo 4 c'16
  \unfoldRepeats c'4:16
}
@end lilypond
